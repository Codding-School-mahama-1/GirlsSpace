<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat Room - Girls Space</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message { animation: fadeIn 0.3s ease; }
        body { background: radial-gradient(circle, #be185d, #e9ecef 95%); transition: background 0.5s ease; }
        .messages { background-size: cover; background-position: center; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        
        /* Audio recording styles */
        .audio-recording { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Theme colors */
        .theme-pink { --primary-color: #ec4899; --secondary-color: #f472b6; }
        .theme-blue { --primary-color: #3b82f6; --secondary-color: #60a5fa; }
        .theme-purple { --primary-color: #8b5cf6; --secondary-color: #a78bfa; }
        .theme-green { --primary-color: #10b981; --secondary-color: #34d399; }
        
        /* Video call styles */
        .video-call-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .video-call-container { backdrop-filter: blur(10px); }
        
        /* Language translation styles */
        .translation-active { border: 2px solid #3b82f6 !important; }
        
        /* Custom Auth Modal Styles */
        .auth-modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 0.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            background: none;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            color: #6b7280;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            color: #ec4899;
            background-color: #fdf2f8;
            box-shadow: 0 2px 4px rgba(236, 72, 153, 0.2);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .forgot-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .forgot-link:hover {
            text-decoration: underline;
        }
        
        .success-message {
            color: #10b981;
            background-color: #d1fae5;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            display: none;
        }
        
        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .password-input {
            position: relative;
        }
        
        .form-input {
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }
        
        .form-button {
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .divider {
            margin: 1rem 0;
            font-size: 0.875rem;
        }
        
        .login-modal {
            padding: 1rem;
            align-items: flex-start;
            padding-top: 5vh;
        }
        
        /* Error message styles */
        .error-message {
            color: #ef4444;
            background-color: #fee2e2;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* Welcome message styles */
        .welcome-container {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            margin: 2rem auto;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 9999;
            display: none;
        }
        
        .online-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 9999;
            display: none;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ec4899;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden theme-pink">
    <!-- Online/Offline Indicators -->
    <div class="offline-indicator" id="offline-indicator">
        <i class="fas fa-wifi-slash mr-2"></i> You're offline
    </div>
    <div class="online-indicator" id="online-indicator">
        <i class="fas fa-wifi mr-2"></i> You're back online
    </div>

    <!-- Login Modal -->
    <div class="login-modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[2000] hidden" id="login-modal">
        <div class="auth-modal-content">
            <h2 class="text-pink-600 text-center text-xl font-bold mb-4">Welcome to Girls Chat</h2>
            
            <button id="google-login-btn" class="w-full py-2 bg-blue-600 text-white rounded-lg mb-3 flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors text-sm">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
            
            <div class="divider relative my-4 text-center text-gray-600 text-sm">
                <span class="bg-white px-3 relative z-10">or</span>
                <div class="absolute top-1/2 left-0 right-0 h-px bg-gray-300 -translate-y-1/2 z-0"></div>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="signin">Sign In</button>
                <button class="auth-tab" data-tab="signup">Create Account</button>
                <button class="auth-tab" data-tab="forgot">Forgot Password</button>
            </div>
            
            <!-- Sign In Form -->
            <form id="signin-form" class="auth-form active">
                <div class="mb-3">
                    <input type="email" id="signin-email" placeholder="Email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                </div>
                <div class="mb-3 password-input">
                    <input type="password" id="signin-password" placeholder="Password" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                        <i class="far fa-eye text-sm"></i>
                    </button>
                </div>
                <button type="submit" id="signin-submit" class="w-full py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium mb-2 text-sm">Sign In</button>
                <div class="text-center">
                    <a class="forgot-link text-xs" onclick="document.querySelector('[data-tab=\"forgot\"]').click()">Forgot Password?</a>
                </div>
            </form>
            
            <!-- Sign Up Form -->
            <form id="signup-form" class="auth-form">
                <div class="mb-3">
                    <input type="text" id="signup-name" placeholder="Full Name" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                </div>
                <div class="mb-3">
                    <input type="email" id="signup-email" placeholder="Email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                </div>
                <div class="mb-3 password-input">
                    <input type="password" id="signup-password" placeholder="Password (min 6 characters)" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                        <i class="far fa-eye text-sm"></i>
                    </button>
                </div>
                <div class="mb-3 password-input">
                    <input type="password" id="signup-confirm-password" placeholder="Confirm Password" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                        <i class="far fa-eye text-sm"></i>
                    </button>
                </div>
                <button type="submit" id="signup-submit" class="w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium text-sm">Create Account</button>
            </form>
            
            <!-- Forgot Password Form -->
            <form id="forgot-form" class="auth-form">
                <div class="mb-3">
                    <input type="email" id="forgot-email" placeholder="Enter your email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                </div>
                <button type="submit" id="forgot-submit" class="w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium mb-2 text-sm">Reset Password</button>
                <div class="text-center">
                    <a class="forgot-link text-xs" onclick="document.querySelector('[data-tab=\"signin\"]').click()">Back to Sign In</a>
                </div>
            </form>
            
            <div id="auth-success" class="success-message"></div>
            <div id="auth-error" class="text-red-500 text-center mt-2 min-h-[20px] text-xs hidden"></div>
            
            <p class="text-xs text-gray-600 mt-4 text-center">
                By signing in, you agree to our Terms of Service and Privacy Policy
            </p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-[2001] flex items-center justify-center">
        <div class="settings-content bg-white p-6 rounded-2xl w-[90%] max-w-[400px] shadow-2xl">
            <div class="settings-header flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Settings</h3>
                <button id="settings-close" class="text-2xl text-gray-600 hover:text-gray-800">&times;</button>
            </div>
           
            <div class="settings-body">
                <div class="theme-section mb-6">
                    <h4 class="font-semibold text-gray-700 mb-3">Theme Color</h4>
                    <div class="theme-colors flex gap-3">
                        <button class="theme-option w-10 h-10 bg-pink-500 rounded-full hover:opacity-90 border-2 border-blue-500" data-theme="theme-pink"></button>
                        <button class="theme-option w-10 h-10 bg-blue-500 rounded-full hover:opacity-90" data-theme="theme-blue"></button>
                        <button class="theme-option w-10 h-10 bg-purple-500 rounded-full hover:opacity-90" data-theme="theme-purple"></button>
                        <button class="theme-option w-10 h-10 bg-green-500 rounded-full hover:opacity-90" data-theme="theme-green"></button>
                    </div>
                </div>
               
                <div class="signout-section">
                    <button id="signout-btn" class="w-full py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                        <i class="fas fa-sign-out-alt mr-2"></i> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modern Navigation -->
    <nav class="navbar sticky top-0 z-[1000] bg-white shadow-md px-4 py-3 md:px-10 flex flex-wrap items-center justify-between">
        <div class="nav-logo">
            <img src="https://ui-avatars.com/api/?name=Girls+Space&background=ec4899&color=fff" alt="Logo" class="w-16 h-12 object-contain rounded-full max-w-full" onerror="this.src='https://ui-avatars.com/api/?name=Girls+Space&background=ec4899&color=fff'">
        </div>
       
        <div class="hamburger flex flex-col gap-1 cursor-pointer z-[1001] md:hidden">
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-opacity"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
        </div>
       
        <ul class="nav-links fixed top-0 left-[-100%] w-72 h-full bg-white flex flex-col gap-5 p-6 pt-20 shadow-xl transition-transform md:static md:w-auto md:h-auto md:flex-row md:items-center md:gap-4 md:p-0 md:shadow-none md:translate-x-0">
            <li><a href="./index.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Home</a></li>
            <li><a href="./AboutUs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">About</a></li>
            <li><a href="./chat.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Chat</a></li>
            <li><a href="./stoies.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Stories</a></li>
            <li><a href="./learning_programs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Programs</a></li>
            <li><a href="./protection.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Support</a></li>
           
            <li class="dropdown relative">
                <a href="#" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Languages <i class="fas fa-chevron-down"></i></a>
                <ul class="dropdown-menu absolute top-full left-0 bg-white shadow-xl rounded-lg min-w-[130px] p-2 z-[1000] hidden">
                    <li><a href="#" class="language-option translation-active block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="en">English</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="sw">Kiswahili</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="fr">FranÃ§ais</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="rw">Kinyarwanda</a></li>
                </ul>
            </li>
           
            <!-- Login button -->
            <li>
                <button id="nav-login-btn" class="login-btn px-4 py-2 border border-pink-500 text-pink-500 font-semibold rounded-full hover:bg-pink-50 transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </button>
            </li>
           
            <!-- Search button -->
            <li>
                <button id="nav-search-btn" class="donate-btn px-5 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold rounded-full hover:shadow-lg transition-shadow flex items-center">
                    <i class="fas fa-search mr-2"></i> Search
                </button>
            </li>
           
            <li>
                <a href="./Donate.html" class="donate-btn px-5 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold rounded-full hover:shadow-lg transition-shadow">
                    <i class="fas fa-heart mr-2"></i> Donate
                </a>
            </li>
        </ul>

        <div class="nav-overlay fixed inset-0 bg-black bg-opacity-50 hidden z-[999] md:hidden"></div>
    </nav>

    <!-- Main Content -->
    <div class="main-content flex-grow flex items-center justify-center p-5">
        <div class="chat-container w-full max-w-7xl h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row">
            <!-- Sidebar -->
            <div class="sidebar w-full md:w-1/3 lg:w-1/4 bg-pink-100 border-r border-gray-300 flex flex-col">
                <div class="sidebar-header bg-pink-600 text-white text-center p-5">
                    <h2 class="text-xl font-bold mb-1">Let's Chat</h2>
                    <p class="text-sm opacity-80">Connect with fellow entrepreneurs</p>
                </div>
               
                <div class="user-profile flex items-center p-4 border-b border-gray-300">
                    <div class="user-avatar w-12 h-12 rounded-full flex items-center justify-center text-white mr-4 overflow-hidden flex-shrink-0">
                        <img src="https://ui-avatars.com/api/?name=Guest&background=ec4899&color=fff" alt="User Avatar" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=Guest&background=ec4899&color=fff'">
                    </div>
                    <div class="user-info flex-1 min-w-0">
                        <h3 class="font-semibold text-sm truncate" id="user-name">Guest User</h3>
                        <p class="text-xs text-gray-600 truncate" id="user-email">Sign in to chat</p>
                        <div class="online-status flex items-center mt-1">
                            <div class="status-dot w-2 h-2 rounded-full bg-gray-500 mr-1" id="status-dot"></div>
                            <span class="text-xs" id="status-text">Offline</span>
                        </div>
                    </div>
                </div>
               
                <div class="sidebar-tabs flex border-b border-gray-300">
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 bg-white text-pink-600 border-b-2 border-pink-600" data-tab="channels">Channels</div>
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 hover:bg-gray-50 transition-colors" data-tab="people">People</div>
                </div>
               
                <div class="channels flex-1 overflow-y-auto p-5">
                    <h3 class="text-blue-500 font-semibold text-sm mb-4 flex items-center">
                        <i class="fas fa-hashtag mr-2"></i> Discussion Channels
                    </h3>
                    <ul class="channel-list space-y-3">
                        <li class="channel-item bg-white shadow border-l-4 border-pink-600 rounded-lg p-3 cursor-pointer transition-all hover:shadow-md flex items-center" data-channel="ideas">
                            <div class="channel-icon w-9 h-9 rounded-full bg-yellow-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Ideas & Brainstorming</h4>
                                <p class="text-xs text-gray-600 truncate">23 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="support">
                            <div class="channel-icon w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Q&A Support</h4>
                                <p class="text-xs text-gray-600 truncate">45 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="partnerships">
                            <div class="channel-icon w-9 h-9 rounded-full bg-green-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Partnerships</h4>
                                <p class="text-xs text-gray-600 truncate">18 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="growth">
                            <div class="channel-icon w-9 h-9 rounded-full bg-purple-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Growth Strategies</h4>
                                <p class="text-xs text-gray-600 truncate">32 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="resources">
                            <div class="channel-icon w-9 h-9 rounded-full bg-red-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Student Resources</h4>
                                <p class="text-xs text-gray-600 truncate">56 members</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
           
            <!-- Chat Area -->
            <div class="chat-area flex-grow flex flex-col min-w-0">
                <div class="chat-header bg-gray-50 border-b border-gray-300 p-5 flex items-center justify-between">
                    <div class="chat-title flex-1 min-w-0">
                        <h2 id="channel-title" class="text-blue-500 text-lg font-semibold truncate">#ideas</h2>
                        <p id="channel-description" class="text-xs text-gray-600 mt-1 truncate">Share and discuss business ideas with the community</p>
                    </div>
                    <div class="chat-actions flex gap-4 items-center flex-shrink-0">
                        <!-- Video Call Button -->
                        <button id="video-call-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-green-600 transition-colors cursor-pointer" aria-label="Start video call">
                            <i class="fas fa-video"></i>
                        </button>
                       
                        <!-- Audio Call Button -->
                        <button id="audio-call-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-blue-600 transition-colors cursor-pointer" aria-label="Start audio call">
                            <i class="fas fa-phone-alt"></i>
                        </button>
                       
                        <!-- Settings Button -->
                        <button id="settings-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                       
                        <!-- Search Button -->
                        <button id="search-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="Search messages">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
               
                <div class="messages flex-grow p-5 overflow-y-auto flex flex-col gap-5" id="messages-container">
                    <div class="welcome-container">
                        <div class="text-pink-600 text-xl font-semibold mb-2">Welcome to Girls Chat</div>
                        <p class="text-gray-600 mb-4">Please sign in to join the conversation</p>
                        <button id="chat-login-btn" class="px-6 py-2 bg-pink-600 text-white rounded-full hover:bg-pink-700 transition-colors">
                            Sign In to Continue
                        </button>
                    </div>
                </div>
               
                <div class="message-input border-t border-gray-300 p-5 flex items-center gap-3">
                    <!-- Media Upload Buttons -->
                    <div class="media-buttons flex gap-2">
                        <!-- Photo Upload -->
                        <label for="photo-upload" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-500 transition-colors flex-shrink-0">
                            <i class="fas fa-camera"></i>
                            <input type="file" id="photo-upload" accept="image/*" class="hidden">
                        </label>
                       
                        <!-- Video Upload -->
                        <label for="video-upload" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-purple-500 transition-colors flex-shrink-0">
                            <i class="fas fa-video"></i>
                            <input type="file" id="video-upload" accept="video/*" class="hidden">
                        </label>
                       
                        <!-- Audio Recording -->
                        <button id="audio-record" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-red-500 transition-colors flex-shrink-0 relative">
                            <i class="fas fa-microphone" id="audio-recording"></i>
                            <span id="audio-indicator" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                        </button>
                    </div>
                   
                    <!-- Message Input -->
                    <input type="text" id="message-input" placeholder="Type your message here..." class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 transition-colors min-w-0" aria-label="Type your message" disabled>
                   
                    <!-- Send Button -->
                    <button class="send-button bg-pink-600 text-white w-12 h-12 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-500 transition-colors flex-shrink-0" id="send-button" aria-label="Send message" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="search-modal hidden fixed inset-0 bg-black bg-opacity-80 z-[2000] items-center justify-center p-4" id="search-modal">
        <div class="search-modal-content bg-white p-5 rounded-lg w-[90%] max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col">
            <div class="search-modal-header flex justify-between items-center mb-4">
                <h3 class="text-pink-600 font-semibold text-lg">Search Messages</h3>
                <button class="search-modal-close bg-transparent border-none text-2xl text-gray-600 cursor-pointer hover:text-pink-600" id="search-modal-close" aria-label="Close search">&times;</button>
            </div>
            <input type="text" class="search-modal-input w-full p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 mb-4" id="search-modal-input" placeholder="Type to search messages..." aria-label="Search messages">
            <div class="search-results max-h-[300px] overflow-y-auto no-scrollbar" id="search-results">
                <div class="text-gray-500 text-center py-4">Enter a search term to find messages</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-black text-gray-300 py-12 px-6">
        <div class="container max-w-7xl mx-auto">
            <div class="footer-main grid grid-cols-1 md:grid-cols-3 gap-12 mb-8">
                <div class="footer-left flex flex-col gap-4">
                    <div class="footer-logo-section flex items-center gap-3">
                        <img src="https://ui-avatars.com/api/?name=Girls+Space&background=ec4899&color=fff" alt="GirlsSpace Logo" class="footer-logo w-12 h-12 object-contain rounded-full border-2 border-pink-500" onerror="this.src='https://ui-avatars.com/api/?name=Girls+Space&background=ec4899&color=fff'">
                        <p class="footer-subtitle font-semibold text-pink-400 text-base">Empowering Girls, Building Futures</p>
                    </div>
                    <p class="footer-desc text-sm text-gray-400 max-w-[360px]">
                        A safe digital haven where girls in Mahama refugee camp can connect, learn, grow, and thrive.
                    </p>
                    <div class="social-links flex gap-3">
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Quick Links</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Join Chat</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Share Story</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Programs</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Get Help</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Emergency</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Support</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Report</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom pt-6 border-t border-gray-800 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div class="footer-left-info flex flex-col gap-2">
                    <p class="text-sm">Â© 2025 GirlsSpace Mahama. <span class="text-pink-400 font-medium">Empowering girls, always.</span></p>
                    <p class="text-xs text-gray-400">Firebase Chat Application - Connected to Firebase</p>
                </div>
                <div class="footer-right-info text-left md:text-right">
                    <p class="text-sm">Available in: English, FranÃ§ais, Kiswahili, Kinyarwanda, Arabic</p>
                    <p class="text-sm mt-1">Supported by UNHCR, Save The Children, Alight</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD5K27SYd3NzV5FOtMtPZs_l8UhEUq42zc",
            authDomain: "sigin-b3aa1.firebaseapp.com",
            databaseURL: "https://sigin-b3aa1-default-rtdb.firebaseio.com",
            projectId: "sigin-b3aa1",
            storageBucket: "sigin-b3aa1.firebasestorage.app",
            messagingSenderId: "390069352394",
            appId: "1:390069352394:web:aa32d4a640b6f7fee54133",
            measurementId: "G-WF0H2KJN02"
        };

        // Initialize Firebase
        try {
            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            
            console.log("âœ… Firebase initialized successfully!");
            
            // Global variables
            let currentUser = null;
            let currentChannel = 'ideas';
            let unsubscribeMessages = null;
            
            // DOM Elements
            const messagesContainer = document.getElementById('messages-container');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const searchBtn = document.getElementById('search-btn');
            const searchModal = document.getElementById('search-modal');
            const searchModalInput = document.getElementById('search-modal-input');
            const searchResults = document.getElementById('search-results');
            const channelTitle = document.getElementById('channel-title');
            const channelDescription = document.getElementById('channel-description');
            const loginModal = document.getElementById('login-modal');
            const userNameElement = document.getElementById('user-name');
            const userEmailElement = document.getElementById('user-email');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const offlineIndicator = document.getElementById('offline-indicator');
            const onlineIndicator = document.getElementById('online-indicator');
            
            // Handle image errors
            function handleImageError(img) {
                img.onerror = null;
                img.src = 'https://ui-avatars.com/api/?name=User&background=ec4899&color=fff';
            }
            
            // Connection Monitor
            window.addEventListener('online', () => {
                if (onlineIndicator) {
                    onlineIndicator.style.display = 'block';
                    setTimeout(() => {
                        onlineIndicator.style.display = 'none';
                    }, 3000);
                }
                if (offlineIndicator) offlineIndicator.style.display = 'none';
            });
            
            window.addEventListener('offline', () => {
                if (offlineIndicator) offlineIndicator.style.display = 'block';
                if (onlineIndicator) onlineIndicator.style.display = 'none';
            });
            
            // Initialize auth state
            auth.onAuthStateChanged((user) => {
                console.log("Auth state changed:", user ? `Logged in as ${user.email}` : "Logged out");
                currentUser = user;
                
                if (user) {
                    updateUIForLoggedInUser(user);
                    loadMessages(currentChannel);
                } else {
                    updateUIForLoggedOut();
                    showWelcomeMessage();
                }
            });
            
            function updateUIForLoggedInUser(user) {
                if (userNameElement) {
                    userNameElement.textContent = user.displayName || user.email.split('@')[0];
                }
                if (userEmailElement) {
                    userEmailElement.textContent = user.email;
                }
                if (statusDot) {
                    statusDot.classList.remove('bg-gray-500');
                    statusDot.classList.add('bg-green-500');
                }
                if (statusText) {
                    statusText.textContent = 'Online';
                }
                
                if (messageInput) {
                    messageInput.disabled = false;
                    messageInput.placeholder = 'Type your message here...';
                }
                if (sendButton) {
                    sendButton.disabled = false;
                }
                
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.innerHTML = '<i class="fas fa-sign-out-alt mr-2"></i> Logout';
                }
                
                const chatLoginBtn = document.getElementById('chat-login-btn');
                if (chatLoginBtn) {
                    chatLoginBtn.style.display = 'none';
                }
                
                if (loginModal) {
                    loginModal.classList.add('hidden');
                }
            }
            
            function updateUIForLoggedOut() {
                if (userNameElement) {
                    userNameElement.textContent = 'Guest User';
                }
                if (userEmailElement) {
                    userEmailElement.textContent = 'Sign in to chat';
                }
                if (statusDot) {
                    statusDot.classList.remove('bg-green-500');
                    statusDot.classList.add('bg-gray-500');
                }
                if (statusText) {
                    statusText.textContent = 'Offline';
                }
                
                if (messageInput) {
                    messageInput.disabled = true;
                    messageInput.placeholder = 'Sign in to chat';
                }
                if (sendButton) {
                    sendButton.disabled = true;
                }
                
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> Login';
                }
                
                const chatLoginBtn = document.getElementById('chat-login-btn');
                if (chatLoginBtn) {
                    chatLoginBtn.style.display = 'inline-block';
                }
            }
            
            function showWelcomeMessage() {
                if (messagesContainer) {
                    messagesContainer.innerHTML = `
                        <div class="welcome-container">
                            <div class="text-pink-600 text-xl font-semibold mb-2">Welcome to Girls Chat</div>
                            <p class="text-gray-600 mb-4">Please sign in to join the conversation</p>
                            <button id="chat-login-btn" class="px-6 py-2 bg-pink-600 text-white rounded-full hover:bg-pink-700 transition-colors">
                                Sign In to Continue
                            </button>
                        </div>
                    `;
                }
            }
            
            // Setup event listeners
            document.addEventListener('DOMContentLoaded', () => {
                console.log("ðŸš€ DOM loaded, initializing chat...");
                
                // Setup navigation toggle
                const hamburger = document.querySelector('.hamburger');
                const navLinks = document.querySelector('.nav-links');
                const navOverlay = document.querySelector('.nav-overlay');
                
                if (hamburger && navLinks && navOverlay) {
                    hamburger.addEventListener('click', () => {
                        hamburger.classList.toggle('active');
                        navLinks.style.left = navLinks.style.left === '0px' ? '-100%' : '0px';
                        navOverlay.classList.toggle('hidden');
                    });
                    
                    navOverlay.addEventListener('click', () => {
                        hamburger.classList.remove('active');
                        navLinks.style.left = '-100%';
                        navOverlay.classList.add('hidden');
                    });
                }
                
                // Setup dropdowns
                document.querySelectorAll('.dropdown').forEach(dropdown => {
                    const link = dropdown.querySelector('.nav-link');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    
                    if (link && menu) {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            menu.classList.toggle('hidden');
                        });
                    }
                });
                
                // Navigation login button
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        if (currentUser) {
                            auth.signOut().then(() => {
                                console.log("âœ… Logged out successfully");
                            }).catch(error => {
                                console.error("Logout error:", error);
                            });
                        } else {
                            if (loginModal) {
                                loginModal.classList.remove('hidden');
                            }
                        }
                    });
                }
                
                // Chat login button
                const chatLoginBtn = document.getElementById('chat-login-btn');
                if (chatLoginBtn) {
                    chatLoginBtn.addEventListener('click', () => {
                        if (loginModal) {
                            loginModal.classList.remove('hidden');
                        }
                    });
                }
                
                // Search button
                const searchBtn = document.getElementById('search-btn');
                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        if (!currentUser) {
                            alert("Please sign in to search messages");
                            return;
                        }
                        if (searchModal) {
                            searchModal.classList.remove('hidden');
                        }
                    });
                }
                
                // Search modal close
                const searchModalClose = document.getElementById('search-modal-close');
                if (searchModalClose) {
                    searchModalClose.addEventListener('click', () => {
                        if (searchModal) {
                            searchModal.classList.add('hidden');
                        }
                    });
                }
                
                // Settings button
                const settingsBtn = document.getElementById('settings-btn');
                const settingsModal = document.getElementById('settings-modal');
                const settingsClose = document.getElementById('settings-close');
                const signoutBtn = document.getElementById('signout-btn');
                
                if (settingsBtn && settingsModal) {
                    settingsBtn.addEventListener('click', () => {
                        settingsModal.classList.remove('hidden');
                    });
                }
                
                if (settingsClose && settingsModal) {
                    settingsClose.addEventListener('click', () => {
                        settingsModal.classList.add('hidden');
                    });
                }
                
                if (signoutBtn) {
                    signoutBtn.addEventListener('click', () => {
                        auth.signOut().then(() => {
                            if (settingsModal) {
                                settingsModal.classList.add('hidden');
                            }
                        });
                    });
                }
                
                // Theme switching
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const theme = e.target.getAttribute('data-theme');
                        document.body.className = document.body.className.replace(/theme-\w+/g, '');
                        document.body.classList.add(theme);
                        localStorage.setItem('chat-theme', theme);
                        
                        document.querySelectorAll('.theme-option').forEach(opt => {
                            opt.classList.remove('border-2', 'border-blue-500');
                        });
                        option.classList.add('border-2', 'border-blue-500');
                    });
                });
                
                // Load saved theme
                const savedTheme = localStorage.getItem('chat-theme') || 'theme-pink';
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(savedTheme);
                document.querySelectorAll('.theme-option').forEach(opt => {
                    if (opt.getAttribute('data-theme') === savedTheme) {
                        opt.classList.add('border-2', 'border-blue-500');
                    }
                });
                
                // Channel switching
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.channel-item').forEach(i => {
                            i.classList.remove('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        });
                        item.classList.add('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        const channelId = item.getAttribute('data-channel');
                        switchChannel(channelId);
                    });
                });
                
                // Set initial active channel
                const initialChannel = document.querySelector('.channel-item[data-channel="ideas"]');
                if (initialChannel) {
                    initialChannel.click();
                }
                
                // Send message functionality
                if (sendButton) {
                    sendButton.addEventListener('click', sendMessage);
                }
                
                if (messageInput) {
                    messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            sendMessage();
                        }
                    });
                }
                
                // Auth forms
                setupAuthForms();
                
                console.log("âœ… Chat initialization complete!");
            });
            
            function switchChannel(channelId) {
                console.log(`ðŸ”„ Switching to channel: #${channelId}`);
                currentChannel = channelId;
                
                if (channelTitle) channelTitle.textContent = `#${channelId}`;
                
                const channelDescriptions = {
                    ideas: 'Share and discuss business ideas with the community',
                    support: 'Get answers to your questions and help others',
                    partnerships: 'Find collaborators and business partners',
                    growth: 'Discuss strategies for scaling your business',
                    resources: 'Share and discover helpful student resources'
                };
                
                if (channelDescription && channelDescriptions[channelId]) {
                    channelDescription.textContent = channelDescriptions[channelId];
                }
                
                loadMessages(channelId);
            }
            
            function loadMessages(channelId) {
                console.log(`ðŸ“¥ Loading messages for #${channelId}...`);
                
                if (!currentUser) {
                    showWelcomeMessage();
                    return;
                }
                
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">Loading messages...</div>';
                }
                
                if (unsubscribeMessages) {
                    unsubscribeMessages();
                }
                
                try {
                    const messagesQuery = db.collection("messages")
                        .where("channel", "==", channelId)
                        .orderBy("timestamp", "asc");
                    
                    unsubscribeMessages = messagesQuery.onSnapshot(
                        (snapshot) => {
                            console.log(`ðŸ“Š Received ${snapshot.size} messages`);
                            
                            if (messagesContainer) {
                                messagesContainer.innerHTML = '';
                                
                                if (snapshot.empty) {
                                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">No messages yet. Be the first to say hi! ðŸ‘‹</div>';
                                    return;
                                }
                                
                                snapshot.forEach((doc) => {
                                    const message = doc.data();
                                    displayMessage(message);
                                });
                                
                                setTimeout(() => {
                                    if (messagesContainer) {
                                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                                    }
                                }, 100);
                            }
                        },
                        (error) => {
                            console.error("âŒ Error loading messages:", error);
                            
                            if (error.code === 'failed-precondition') {
                                console.error("âš ï¸ Firestore index required!");
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = `
                                        <div class="error-message show">
                                            <div class="flex items-center">
                                                <i class="fas fa-exclamation-circle mr-2"></i>
                                                <span>Firestore index required. Please create an index for the messages collection.</span>
                                            </div>
                                        </div>
                                    `;
                                }
                            } else {
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = `
                                        <div class="error-message show">
                                            <div class="flex items-center">
                                                <i class="fas fa-exclamation-circle mr-2"></i>
                                                <span>Failed to load messages. Please try again.</span>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
                        }
                    );
                } catch (error) {
                    console.error("âŒ Error setting up listener:", error);
                }
            }
            
            function displayMessage(message) {
                if (!messagesContainer) return;
                
                const messageDiv = document.createElement('div');
                const isCurrentUser = currentUser && message.senderId === currentUser.uid;
                
                messageDiv.className = `message flex max-w-[80%] mb-4 ${isCurrentUser ? 'self-end flex-row-reverse' : 'self-start'}`;
                
                let timeString = 'Just now';
                if (message.timestamp) {
                    try {
                        const date = message.timestamp.toDate();
                        const now = new Date();
                        const diffMs = now - date;
                        const diffMins = Math.floor(diffMs / 60000);
                        
                        if (diffMins < 1) timeString = 'Just now';
                        else if (diffMins < 60) timeString = `${diffMins}m ago`;
                        else if (diffMins < 1440) timeString = `${Math.floor(diffMins / 60)}h ago`;
                        else {
                            timeString = date.toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }
                    } catch (error) {
                        console.error("Error formatting time:", error);
                    }
                }
                
                const avatarImg = message.senderAvatar || '';
                const displayName = message.senderName || 'Anonymous';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar w-10 h-10 rounded-full flex items-center justify-center text-white mx-2 flex-shrink-0 overflow-hidden ${isCurrentUser ? 'bg-yellow-600' : 'bg-pink-300'}">
                        ${avatarImg ?
                            `<img src="${avatarImg}" alt="${displayName}" class="w-full h-full object-cover" onerror="handleImageError(this)">` :
                            `<span class="text-lg font-semibold">${displayName.charAt(0).toUpperCase()}</span>`
                        }
                    </div>
                    <div class="message-content px-4 py-3 rounded-2xl shadow-sm ${isCurrentUser ? 'bg-pink-300 text-white rounded-tr-none' : 'bg-pink-100 rounded-tl-none'}">
                        <div class="message-sender font-semibold text-sm mb-1 ${isCurrentUser ? 'text-gray-100' : 'text-pink-600'}">${displayName}</div>
                        <div class="message-text text-sm">${message.text || ''}</div>
                        <div class="message-time text-xs opacity-70 mt-1 text-right">${timeString}</div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            }
            
            async function sendMessage() {
                if (!currentUser) {
                    alert("Please sign in to send messages");
                    if (loginModal) {
                        loginModal.classList.remove('hidden');
                    }
                    return;
                }
                
                const messageText = messageInput.value.trim();
                if (!messageText) return;
                
                try {
                    const message = {
                        text: messageText,
                        senderId: currentUser.uid,
                        senderName: currentUser.displayName || currentUser.email.split('@')[0],
                        senderAvatar: currentUser.photoURL || '',
                        channel: currentChannel,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        readBy: []
                    };
                    
                    console.log("ðŸ“¨ Sending message to Firestore...");
                    
                    await db.collection("messages").add(message);
                    
                    messageInput.value = '';
                    messageInput.focus();
                    console.log("âœ… Message sent successfully!");
                    
                } catch (error) {
                    console.error("âŒ Error sending message:", error);
                    alert("Failed to send message. Please try again.");
                }
            }
            
            function setupAuthForms() {
                // Tab switching
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.getAttribute('data-tab');
                        switchAuthTab(tabId);
                    });
                });
                
                // Sign in form
                const signinForm = document.getElementById('signin-form');
                if (signinForm) {
                    signinForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = document.getElementById('signin-email').value.trim();
                        const password = document.getElementById('signin-password').value;
                        const submitBtn = document.getElementById('signin-submit');
                        
                        if (!email || !password) {
                            showAuthError("Please fill in all fields");
                            return;
                        }
                        
                        try {
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                            
                            await auth.signInWithEmailAndPassword(email, password);
                            
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Sign In';
                            clearAuthMessages();
                            
                        } catch (error) {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Sign In';
                            
                            let errorMessage = "Login failed";
                            switch(error.code) {
                                case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                                case 'auth/user-not-found': errorMessage = "No account found with this email"; break;
                                case 'auth/wrong-password': errorMessage = "Wrong password"; break;
                                case 'auth/too-many-requests': errorMessage = "Too many attempts. Try again later"; break;
                                default: errorMessage = "Login failed: " + error.message;
                            }
                            showAuthError(errorMessage);
                        }
                    });
                }
                
                // Sign up form
                const signupForm = document.getElementById('signup-form');
                if (signupForm) {
                    signupForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const name = document.getElementById('signup-name').value.trim();
                        const email = document.getElementById('signup-email').value.trim();
                        const password = document.getElementById('signup-password').value;
                        const confirmPassword = document.getElementById('signup-confirm-password').value;
                        const submitBtn = document.getElementById('signup-submit');
                        
                        if (!name || !email || !password || !confirmPassword) {
                            showAuthError("Please fill in all fields");
                            return;
                        }
                        
                        if (password.length < 6) {
                            showAuthError("Password must be at least 6 characters");
                            return;
                        }
                        
                        if (password !== confirmPassword) {
                            showAuthError("Passwords do not match");
                            return;
                        }
                        
                        try {
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                            
                            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                            
                            // Update profile with name
                            await userCredential.user.updateProfile({
                                displayName: name
                            });
                            
                            // Try to save to Firestore
                            try {
                                await db.collection("users").doc(userCredential.user.uid).set({
                                    uid: userCredential.user.uid,
                                    email: userCredential.user.email,
                                    displayName: name,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            } catch (firestoreError) {
                                console.warn("Could not save user to Firestore:", firestoreError);
                            }
                            
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Create Account';
                            showAuthSuccess("Account created successfully!");
                            
                            // Switch to sign in tab after success
                            setTimeout(() => {
                                switchAuthTab('signin');
                                document.getElementById('signin-email').value = email;
                                document.getElementById('signin-password').value = '';
                            }, 2000);
                            
                        } catch (error) {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Create Account';
                            
                            let errorMessage = "Signup failed";
                            switch(error.code) {
                                case 'auth/email-already-in-use': errorMessage = "Email already in use"; break;
                                case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                                case 'auth/weak-password': errorMessage = "Password too weak"; break;
                                default: errorMessage = "Signup failed: " + error.message;
                            }
                            showAuthError(errorMessage);
                        }
                    });
                }
                
                // Forgot password form
                const forgotForm = document.getElementById('forgot-form');
                if (forgotForm) {
                    forgotForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = document.getElementById('forgot-email').value.trim();
                        const submitBtn = document.getElementById('forgot-submit');
                        
                        if (!email) {
                            showAuthError("Please enter your email");
                            return;
                        }
                        
                        try {
                            submitBtn.disabled = true;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                            
                            await auth.sendPasswordResetEmail(email);
                            
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Reset Password';
                            showAuthSuccess("Password reset email sent! Check your inbox.");
                            
                        } catch (error) {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = 'Reset Password';
                            
                            let errorMessage = "Failed to send reset email";
                            switch(error.code) {
                                case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                                case 'auth/user-not-found': errorMessage = "No account found with this email"; break;
                                default: errorMessage = "Failed to send reset email: " + error.message;
                            }
                            showAuthError(errorMessage);
                        }
                    });
                }
                
                // Google login
                const googleLoginBtn = document.getElementById('google-login-btn');
                if (googleLoginBtn) {
                    googleLoginBtn.addEventListener('click', async () => {
                        try {
                            googleLoginBtn.disabled = true;
                            googleLoginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                            
                            const provider = new firebase.auth.GoogleAuthProvider();
                            await auth.signInWithPopup(provider);
                            
                            googleLoginBtn.disabled = false;
                            googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                            
                        } catch (error) {
                            googleLoginBtn.disabled = false;
                            googleLoginBtn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                            showAuthError("Google login failed: " + error.message);
                        }
                    });
                }
            }
            
            function switchAuthTab(tabId) {
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });
                
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.toggle('active', form.id === `${tabId}-form`);
                });
                
                clearAuthMessages();
            }
            
            function clearAuthMessages() {
                const errorDiv = document.getElementById('auth-error');
                const successDiv = document.getElementById('auth-success');
                if (errorDiv) {
                    errorDiv.classList.add('hidden');
                    errorDiv.textContent = '';
                }
                if (successDiv) {
                    successDiv.style.display = 'none';
                    successDiv.textContent = '';
                }
            }
            
            function showAuthError(message) {
                const errorDiv = document.getElementById('auth-error');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.classList.remove('hidden');
                    
                    setTimeout(() => {
                        errorDiv.textContent = '';
                        errorDiv.classList.add('hidden');
                    }, 5000);
                }
            }
            
            function showAuthSuccess(message) {
                const successDiv = document.getElementById('auth-success');
                if (successDiv) {
                    successDiv.textContent = message;
                    successDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        successDiv.style.display = 'none';
                        successDiv.textContent = '';
                    }, 5000);
                }
            }
            
        } catch (error) {
            console.error("âŒ Firebase initialization error:", error);
            alert("Error initializing Firebase. Please check console.");
        }
    </script>
</body>
</html>