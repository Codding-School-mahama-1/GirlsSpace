<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat Room - Girls Space</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message { animation: fadeIn 0.3s ease; }
        body { background: radial-gradient(circle, #be185d, #e9ecef 95%); }
        .messages { background-image: url(./imge/hp1.png); background-size: cover; background-position: center; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            orderBy,
            onSnapshot,
            serverTimestamp,
            getDocs
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC5_OQUVnBC1BE_0C4At39xSR0pHBp-wws",
            authDomain: "chat-room-5c3e5.firebaseapp.com",
            projectId: "chat-room-5c3e5",
            storageBucket: "chat-room-5c3e5.firebasestorage.app",
            messagingSenderId: "637694009856",
            appId: "1:637694009856:web:8de78eda815ac24d3daee5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        console.log("üî• Firebase initialized with project: chat-room-5c3e5");

        // Global variables
        let currentUser = null;
        let currentChannel = 'ideas';
        let unsubscribeMessages = null;
        let currentLang = 'en';

        // DOM Elements
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const searchBtn = document.getElementById('search-btn');
        const searchModal = document.getElementById('search-modal');
        const searchModalInput = document.getElementById('search-modal-input');
        const searchResults = document.getElementById('search-results');
        const channelTitle = document.getElementById('channel-title');
        const channelDescription = document.getElementById('channel-description');
        const loginModal = document.getElementById('login-modal');

        // Image error handler
        function handleImageError(img) {
            img.onerror = null;
            img.src = 'https://ui-avatars.com/api/?name=User&background=ec4899&color=fff';
        }

        // Authentication Manager
        class AuthManager {
            constructor() {
                console.log("üîê AuthManager initialized");
                this.initAuth();
            }

            initAuth() {
                onAuthStateChanged(auth, (user) => {
                    console.log("Auth state changed:", user ? `Logged in as ${user.email}` : "Logged out");
                    if (user) {
                        currentUser = user;
                        this.updateUIForLoggedInUser(user);
                        if (window.chatManager) {
                            window.chatManager.switchChannel(currentChannel);
                        }
                        loginModal.classList.add('hidden');
                    } else {
                        currentUser = null;
                        this.updateUIForLoggedOut();
                        loginModal.classList.remove('hidden');
                    }
                }, (error) => {
                    console.error("Auth error:", error);
                });
            }

            updateUIForLoggedInUser(user) {
                const userAvatar = document.querySelector('.user-avatar img');
                const userName = document.querySelector('.user-info h3');
                const userRole = document.querySelector('.user-info p');
                const onlineStatus = document.querySelector('.online-status span');
                const statusDot = document.querySelector('.status-dot');
                
                if (user.photoURL) {
                    userAvatar.src = user.photoURL;
                }
                
                userName.textContent = user.displayName || user.email.split('@')[0];
                userRole.textContent = user.email;
                
                if (statusDot) {
                    statusDot.classList.remove('bg-gray-500');
                    statusDot.classList.add('bg-green-500');
                }
                if (onlineStatus) onlineStatus.textContent = 'Online';
                
                const loginBtn = document.querySelector('.login-btn[data-translate="login"]');
                if (loginBtn) {
                    loginBtn.textContent = 'Logout';
                    loginBtn.onclick = (e) => {
                        e.preventDefault();
                        this.logout();
                    };
                }
            }

            updateUIForLoggedOut() {
                const userAvatar = document.querySelector('.user-avatar img');
                const userName = document.querySelector('.user-info h3');
                const userRole = document.querySelector('.user-info p');
                const onlineStatus = document.querySelector('.online-status span');
                const statusDot = document.querySelector('.status-dot');
                
                if (userAvatar) userAvatar.src = 'img/girl.png';
                if (userName) userName.textContent = 'Guest User';
                if (userRole) userRole.textContent = 'Sign in to chat';
                
                if (statusDot) {
                    statusDot.classList.remove('bg-green-500');
                    statusDot.classList.add('bg-gray-500');
                }
                if (onlineStatus) onlineStatus.textContent = 'Offline';
                
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">Please sign in to view messages</div>';
                }
                
                const loginBtn = document.querySelector('.login-btn[data-translate="login"]');
                if (loginBtn) {
                    loginBtn.textContent = 'Login';
                    loginBtn.onclick = null;
                }
                
                if (unsubscribeMessages) {
                    unsubscribeMessages();
                    unsubscribeMessages = null;
                }
            }

            async loginWithGoogle() {
                try {
                    const provider = new GoogleAuthProvider();
                    const result = await signInWithPopup(auth, provider);
                    console.log("‚úÖ Google login successful");
                    return result.user;
                } catch (error) {
                    console.error("Google login error:", error);
                    this.showError("Google login failed");
                    throw error;
                }
            }

            async loginWithEmail(email, password) {
                try {
                    const result = await signInWithEmailAndPassword(auth, email, password);
                    console.log("‚úÖ Email login successful");
                    return result.user;
                } catch (error) {
                    console.error("Email login error:", error.code);
                    let errorMessage = "Login failed";
                    switch(error.code) {
                        case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                        case 'auth/user-not-found': errorMessage = "No account found"; break;
                        case 'auth/wrong-password': errorMessage = "Wrong password"; break;
                        case 'auth/too-many-requests': errorMessage = "Too many attempts"; break;
                        default: errorMessage = "Login failed";
                    }
                    this.showError(errorMessage);
                    throw error;
                }
            }

            async signupWithEmail(email, password) {
                try {
                    const result = await createUserWithEmailAndPassword(auth, email, password);
                    console.log("‚úÖ Account created successfully");
                    
                    // Create user profile in Firestore
                    try {
                        await addDoc(collection(db, "users"), {
                            uid: result.user.uid,
                            email: result.user.email,
                            displayName: result.user.email.split('@')[0],
                            createdAt: serverTimestamp()
                        });
                    } catch (firestoreError) {
                        console.warn("Note: User profile not saved to Firestore (optional)");
                    }
                    
                    return result.user;
                } catch (error) {
                    console.error("Signup error:", error.code);
                    let errorMessage = "Signup failed";
                    switch(error.code) {
                        case 'auth/email-already-in-use': errorMessage = "Email already in use"; break;
                        case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                        case 'auth/weak-password': errorMessage = "Password too weak (min 6 chars)"; break;
                        default: errorMessage = "Signup failed";
                    }
                    this.showError(errorMessage);
                    throw error;
                }
            }

            async logout() {
                try {
                    await signOut(auth);
                    console.log("‚úÖ Logout successful");
                } catch (error) {
                    console.error("Logout error:", error);
                    this.showError("Logout failed");
                }
            }

            showError(message) {
                const errorDiv = document.getElementById('error-message');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.classList.remove('hidden');
                    setTimeout(() => {
                        errorDiv.textContent = '';
                        errorDiv.classList.add('hidden');
                    }, 5000);
                } else {
                    alert(message);
                }
            }
        }

        // Chat Manager
        class ChatManager {
            constructor() {
                console.log("üí¨ ChatManager initialized");
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Send message
                if (sendButton) {
                    sendButton.addEventListener('click', () => this.sendMessage());
                }
                
                if (messageInput) {
                    messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                }

                // Channel switching
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.channel-item').forEach(i => {
                            i.classList.remove('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        });
                        item.classList.add('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        const channelId = item.getAttribute('data-channel');
                        this.switchChannel(channelId);
                    });
                });

                // Search functionality
                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        searchModal.classList.remove('hidden');
                        setTimeout(() => {
                            if (searchModalInput) searchModalInput.focus();
                        }, 100);
                    });
                }

                const searchModalClose = document.getElementById('search-modal-close');
                if (searchModalClose) {
                    searchModalClose.addEventListener('click', () => {
                        searchModal.classList.add('hidden');
                        if (searchModalInput) searchModalInput.value = '';
                        if (searchResults) {
                            searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                        }
                    });
                }

                if (searchModalInput) {
                    searchModalInput.addEventListener('input', () => this.searchMessages());
                }
            }

            async sendMessage() {
                if (!currentUser) {
                    alert("Please sign in to send messages");
                    return;
                }

                const messageText = messageInput.value.trim();
                if (!messageText) return;

                try {
                    const message = {
                        text: messageText,
                        senderId: currentUser.uid,
                        senderName: currentUser.displayName || currentUser.email.split('@')[0],
                        senderAvatar: currentUser.photoURL || '',
                        channel: currentChannel,
                        timestamp: serverTimestamp(),
                        readBy: []
                    };

                    console.log("üì® Sending message to Firestore...");
                    
                    await addDoc(collection(db, "messages"), message);
                    
                    messageInput.value = '';
                    messageInput.focus();
                    console.log("‚úÖ Message sent successfully!");
                    
                } catch (error) {
                    console.error("‚ùå Error sending message:", error);
                    alert("Failed to send message. Check console for details.");
                }
            }

            switchChannel(channelId) {
                console.log(`üîÑ Switching to channel: #${channelId}`);
                currentChannel = channelId;
                
                if (channelTitle) channelTitle.textContent = `#${channelId}`;
                
                const channelDescriptions = {
                    ideas: "Share and discuss business ideas with the community",
                    support: "Get answers to your questions and help others",
                    partnerships: "Find collaborators and business partners",
                    growth: "Discuss strategies for scaling your business",
                    resources: "Share and discover helpful student resources"
                };
                
                if (channelDescription && channelDescriptions[channelId]) {
                    channelDescription.textContent = channelDescriptions[channelId];
                }
                
                this.loadMessages(channelId);
            }

            loadMessages(channelId) {
                console.log(`üì• Loading messages for #${channelId}...`);
                
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">Loading messages...</div>';
                }
                
                if (unsubscribeMessages) {
                    unsubscribeMessages();
                }
                
                try {
                    const messagesQuery = query(
                        collection(db, "messages"),
                        where("channel", "==", channelId),
                        orderBy("timestamp", "asc")
                    );
                    
                    unsubscribeMessages = onSnapshot(messagesQuery, 
                        (snapshot) => {
                            console.log(`üìä Received ${snapshot.size} messages`);
                            
                            if (messagesContainer) {
                                messagesContainer.innerHTML = '';
                                
                                if (snapshot.empty) {
                                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">No messages yet. Be the first to say hi! üëã</div>';
                                    return;
                                }
                                
                                snapshot.forEach((doc) => {
                                    const message = doc.data();
                                    this.displayMessage(message);
                                });
                                
                                setTimeout(() => {
                                    if (messagesContainer) {
                                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                                    }
                                }, 100);
                            }
                        }, 
                        (error) => {
                            console.error("‚ùå Error loading messages:", error);
                            
                            // Check for index error
                            if (error.code === 'failed-precondition') {
                                console.error("‚ö†Ô∏è Firestore index required! Please create the composite index:");
                                console.error("Collection: 'messages'");
                                console.error("Fields indexed: 'channel' Ascending, 'timestamp' Ascending");
                                console.error("Click the link in the error message to create it automatically.");
                                
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = `
                                        <div class="text-red-500 text-center py-4">
                                            <p class="font-bold">Firestore Index Required</p>
                                            <p class="text-sm mt-2">Check browser console for details and click the link to create the index.</p>
                                        </div>`;
                                }
                            } else {
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = '<div class="text-red-500 text-center py-4">Failed to load messages</div>';
                                }
                            }
                        }
                    );
                } catch (error) {
                    console.error("‚ùå Error setting up listener:", error);
                    if (messagesContainer) {
                        messagesContainer.innerHTML = '<div class="text-red-500 text-center py-4">Error setting up chat</div>';
                    }
                }
            }

            displayMessage(message) {
                if (!messagesContainer) return;
                
                const messageDiv = document.createElement('div');
                const isCurrentUser = currentUser && message.senderId === currentUser.uid;
                
                messageDiv.className = `message flex max-w-[80%] ${isCurrentUser ? 'self-end flex-row-reverse' : 'self-start'}`;
                
                let timeString = 'Just now';
                if (message.timestamp && message.timestamp.toDate) {
                    try {
                        const date = message.timestamp.toDate();
                        timeString = this.formatTime(date);
                    } catch (error) {
                        console.error("Error formatting time:", error);
                    }
                }
                
                const avatarImg = message.senderAvatar || '';
                const displayName = message.senderName || 'Anonymous';
                
                messageDiv.innerHTML = `
                    <div class="message-avatar w-10 h-10 rounded-full flex items-center justify-center text-white mx-2 flex-shrink-0 overflow-hidden ${isCurrentUser ? 'bg-yellow-600' : 'bg-pink-300'}">
                        ${avatarImg ? 
                            `<img src="${avatarImg}" alt="${displayName}" class="w-full h-full object-cover" onerror="handleImageError(this)">` :
                            `<span class="text-lg font-semibold">${displayName.charAt(0).toUpperCase()}</span>`
                        }
                    </div>
                    <div class="message-content px-4 py-3 rounded-2xl shadow-sm ${isCurrentUser ? 'bg-pink-300 text-white rounded-tr-none' : 'bg-pink-100 rounded-tl-none'}">
                        <div class="message-sender font-semibold text-sm mb-1 ${isCurrentUser ? 'text-gray-100' : 'text-pink-600'}">${displayName}</div>
                        <div class="message-text text-sm">${message.text.replace(/\n/g, '<br>')}</div>
                        <div class="message-time text-xs opacity-70 mt-1 text-right">${timeString}</div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            }

            async searchMessages() {
                const searchTerm = searchModalInput.value.trim().toLowerCase();
                
                if (!searchTerm) {
                    if (searchResults) {
                        searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                    }
                    return;
                }
                
                try {
                    const messagesQuery = query(
                        collection(db, "messages"),
                        orderBy("timestamp", "desc")
                    );
                    
                    const snapshot = await getDocs(messagesQuery);
                    if (searchResults) {
                        searchResults.innerHTML = '';
                    }
                    
                    let foundMessages = [];
                    
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        if (message.text && message.text.toLowerCase().includes(searchTerm) || 
                            message.senderName && message.senderName.toLowerCase().includes(searchTerm)) {
                            foundMessages.push({...message, id: doc.id});
                        }
                    });
                    
                    if (foundMessages.length === 0) {
                        if (searchResults) {
                            searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">No messages found</div>';
                        }
                        return;
                    }
                    
                    foundMessages.forEach((message) => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'search-result-item px-3 py-2 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors';
                        resultItem.innerHTML = `
                            <div class="search-result-sender font-bold text-pink-600">${message.senderName || 'Anonymous'}</div>
                            <div class="search-result-text text-sm mt-1">${message.text || ''}</div>
                            <div class="message-time text-xs text-gray-500 mt-1">${this.formatTime(message.timestamp?.toDate())} ‚Ä¢ #${message.channel || 'unknown'}</div>
                        `;
                        
                        resultItem.addEventListener('click', () => {
                            if (message.channel) {
                                this.switchChannel(message.channel);
                            }
                            searchModal.classList.add('hidden');
                            if (searchModalInput) searchModalInput.value = '';
                            if (searchResults) searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                        });
                        
                        if (searchResults) {
                            searchResults.appendChild(resultItem);
                        }
                    });
                } catch (error) {
                    console.error("Search error:", error);
                    if (searchResults) {
                        searchResults.innerHTML = '<div class="text-red-500 text-center py-4">Search failed</div>';
                    }
                }
            }

            formatTime(date) {
                if (!date) return 'Just now';
                
                try {
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins < 1) return 'Just now';
                    if (diffMins < 60) return `${diffMins}m ago`;
                    if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;
                    
                    return date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return 'Just now';
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log("üöÄ DOM loaded, initializing Girls Chat...");
            
            // Make managers globally available
            window.authManager = new AuthManager();
            window.chatManager = new ChatManager();

            // Login modal event listeners
            const googleLoginBtn = document.getElementById('google-login-btn');
            if (googleLoginBtn) {
                googleLoginBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    try {
                        const btn = googleLoginBtn;
                        const originalText = btn.innerHTML;
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                        
                        await window.authManager.loginWithGoogle();
                        
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                    } catch (error) {
                        const btn = googleLoginBtn;
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                    }
                });
            }
            
            // Email login
            const emailLoginBtn = document.getElementById('email-login-btn');
            if (emailLoginBtn) {
                emailLoginBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email-input')?.value.trim();
                    const password = document.getElementById('password-input')?.value;
                    
                    if (!email) {
                        window.authManager.showError("Please enter email");
                        return;
                    }
                    
                    if (!password) {
                        window.authManager.showError("Please enter password");
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        window.authManager.showError("Invalid email");
                        return;
                    }
                    
                    if (password.length < 6) {
                        window.authManager.showError("Password too short (min 6)");
                        return;
                    }
                    
                    try {
                        const btn = emailLoginBtn;
                        const originalText = btn.textContent;
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                        
                        await window.authManager.loginWithEmail(email, password);
                        
                        btn.disabled = false;
                        btn.textContent = originalText;
                        
                    } catch (error) {
                        const btn = emailLoginBtn;
                        if (btn) {
                            btn.disabled = false;
                            btn.innerHTML = 'Sign in with Email';
                        }
                    }
                });
            }
            
            // Signup button
            const signupBtn = document.getElementById('signup-btn');
            if (signupBtn) {
                signupBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email-input')?.value.trim();
                    const password = document.getElementById('password-input')?.value;
                    
                    if (!email) {
                        window.authManager.showError("Please enter email");
                        return;
                    }
                    
                    if (!password) {
                        window.authManager.showError("Please enter password");
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        window.authManager.showError("Invalid email");
                        return;
                    }
                    
                    if (password.length < 6) {
                        window.authManager.showError("Password too short (min 6)");
                        return;
                    }
                    
                    try {
                        const btn = signupBtn;
                        const originalText = btn.textContent;
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                        
                        await window.authManager.signupWithEmail(email, password);
                        window.authManager.showError("‚úÖ Account created! You are now signed in.");
                        
                        btn.disabled = false;
                        btn.textContent = originalText;
                        
                    } catch (error) {
                        const btn = signupBtn;
                        if (btn) {
                            btn.disabled = false;
                            btn.innerHTML = 'Create Account';
                        }
                    }
                });
            }

            // Enter key support
            const emailInput = document.getElementById('email-input');
            const passwordInput = document.getElementById('password-input');
            
            if (emailInput) {
                emailInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (emailLoginBtn) emailLoginBtn.click();
                    }
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (emailLoginBtn) emailLoginBtn.click();
                    }
                });
            }

            // Set initial active channel
            const initialChannel = document.querySelector('.channel-item[data-channel="ideas"]');
            if (initialChannel) {
                initialChannel.click();
            }
            
            console.log("‚úÖ Girls Chat initialization complete!");
            console.log("üëâ Next steps:");
            console.log("1. Create Firestore Database in Firebase Console");
            console.log("2. Test login/signup");
            console.log("3. Send a message (might need to create an index)");
        });

        // Make functions available globally
        window.handleImageError = handleImageError;
        
        // Global error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });
    </script>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden">
    <!-- Login Modal -->
    <div class="login-modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[2000]" id="login-modal">
        <div class="login-content bg-white p-8 rounded-2xl w-[90%] max-w-[400px] shadow-2xl">
            <h2 class="text-pink-600 text-center text-2xl font-bold mb-6">Welcome to Girls Chat</h2>
            
            <button id="google-login-btn" class="w-full py-3 bg-blue-600 text-white rounded-lg mb-4 flex items-center justify-center gap-3 hover:bg-blue-700 transition-colors">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
            
            <div class="divider relative my-6 text-center text-gray-600">
                <span class="bg-white px-4 relative z-10">or</span>
                <div class="absolute top-1/2 left-0 right-0 h-px bg-gray-300 -translate-y-1/2 z-0"></div>
            </div>
            
            <div id="email-form">
                <input type="email" id="email-input" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-pink-500">
                <input type="password" id="password-input" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-pink-500">
                <button id="email-login-btn" class="w-full py-3 bg-pink-600 text-white rounded-lg mb-3 hover:bg-pink-700 transition-colors font-medium">Sign in with Email</button>
                <button id="signup-btn" class="w-full py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium">Create New Account</button>
            </div>
            
            <div id="error-message" class="text-red-500 text-center mt-3 min-h-[20px] text-sm hidden"></div>
            
            <p class="text-xs text-gray-600 mt-5 text-center">
                By signing in, you agree to our Terms of Service and Privacy Policy
            </p>
        </div>
    </div>

    <!-- Modern Navigation -->
    <nav class="navbar sticky top-0 z-[1000] bg-white shadow-md px-4 py-3 md:px-10 flex flex-wrap items-center justify-between">
        <div class="nav-logo">
            <img src="./img/Girls Space (1) (1) (2).png" alt="Logo" class="w-16 h-12 object-contain rounded-full max-w-full" onerror="handleImageError(this)">
        </div>
        
        <div class="hamburger flex flex-col gap-1 cursor-pointer z-[1001] md:hidden">
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-opacity"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
        </div>
        
        <ul class="nav-links fixed top-0 left-[-100%] w-72 h-full bg-white flex flex-col gap-5 p-6 pt-20 shadow-xl transition-transform md:static md:w-auto md:h-auto md:flex-row md:items-center md:gap-4 md:p-0 md:shadow-none md:translate-x-0">
            <li><a href="./index.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Home</a></li>
            <li><a href="./AboutUs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">About</a></li>
            <li><a href="./chat.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Chat</a></li>
            <li><a href="./stoies.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Stories</a></li>
            <li><a href="./learning_programs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Programs</a></li>
            <li><a href="./protection.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Support</a></li>
            
            <li class="dropdown relative">
                <a href="#" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Languages <i class="fas fa-chevron-down"></i></a>
                <ul class="dropdown-menu absolute top-full left-0 bg-white shadow-xl rounded-lg min-w-[130px] p-2 z-[1000] hidden">
                    <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors">English</a></li>
                    <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors">Arabic</a></li>
                    <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors">Swahili</a></li>
                    <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors">French</a></li>
                    <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors">Kinyarwanda</a></li>
                </ul>
            </li>
            
            <li><a href="#" class="login-btn px-4 py-2 border border-pink-500 text-pink-500 font-semibold rounded-full hover:bg-pink-50 transition-colors">Login</a></li>
            <li><a href="./Donate.html" class="donate-btn px-5 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold rounded-full hover:shadow-lg transition-shadow">Donate</a></li>
        </ul>
        
        <div class="nav-overlay fixed inset-0 bg-black bg-opacity-50 hidden z-[999] md:hidden"></div>
    </nav>

    <!-- Main Content -->
    <div class="main-content flex-grow flex items-center justify-center p-5">
        <div class="chat-container w-full max-w-7xl h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row">
            <!-- Sidebar -->
            <div class="sidebar w-full md:w-1/3 lg:w-1/4 bg-pink-100 border-r border-gray-300 flex flex-col">
                <div class="sidebar-header bg-pink-600 text-white text-center p-5">
                    <h2 class="text-xl font-bold mb-1">Let's Chat</h2>
                    <p class="text-sm opacity-80">Connect with fellow entrepreneurs</p>
                </div>
                
                <div class="user-profile flex items-center p-4 border-b border-gray-300">
                    <div class="user-avatar w-12 h-12 rounded-full flex items-center justify-center text-white mr-4 overflow-hidden flex-shrink-0">
                        <img src="img/girl.png" alt="User Avatar" class="w-full h-full object-cover" onerror="handleImageError(this)">
                    </div>
                    <div class="user-info flex-1 min-w-0">
                        <h3 class="font-semibold text-sm truncate">Guest User</h3>
                        <p class="text-xs text-gray-600 truncate">Sign in to chat</p>
                        <div class="online-status flex items-center mt-1">
                            <div class="status-dot w-2 h-2 rounded-full bg-gray-500 mr-1"></div>
                            <span class="text-xs">Offline</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-tabs flex border-b border-gray-300">
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 bg-white text-pink-600 border-b-2 border-pink-600" data-tab="channels">Channels</div>
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 hover:bg-gray-50 transition-colors" data-tab="people">People</div>
                </div>
                
                <div class="channels flex-1 overflow-y-auto p-5">
                    <h3 class="text-blue-500 font-semibold text-sm mb-4 flex items-center">
                        <i class="fas fa-hashtag mr-2"></i> Discussion Channels
                    </h3>
                    <ul class="channel-list space-y-3">
                        <li class="channel-item bg-white shadow border-l-4 border-pink-600 rounded-lg p-3 cursor-pointer transition-all hover:shadow-md flex items-center" data-channel="ideas">
                            <div class="channel-icon w-9 h-9 rounded-full bg-yellow-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Ideas & Brainstorming</h4>
                                <p class="text-xs text-gray-600 truncate">23 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="support">
                            <div class="channel-icon w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Q&A Support</h4>
                                <p class="text-xs text-gray-600 truncate">45 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="partnerships">
                            <div class="channel-icon w-9 h-9 rounded-full bg-green-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Partnerships</h4>
                                <p class="text-xs text-gray-600 truncate">18 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="growth">
                            <div class="channel-icon w-9 h-9 rounded-full bg-purple-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Growth Strategies</h4>
                                <p class="text-xs text-gray-600 truncate">32 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="resources">
                            <div class="channel-icon w-9 h-9 rounded-full bg-red-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate">Student Resources</h4>
                                <p class="text-xs text-gray-600 truncate">56 members</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Chat Area -->
            <div class="chat-area flex-grow flex flex-col min-w-0">
                <div class="chat-header bg-gray-50 border-b border-gray-300 p-5 flex items-center justify-between">
                    <div class="chat-title flex-1 min-w-0">
                        <h2 id="channel-title" class="text-blue-500 text-lg font-semibold truncate">#ideas</h2>
                        <p id="channel-description" class="text-xs text-gray-600 mt-1 truncate">Share and discuss business ideas with the community</p>
                    </div>
                    <div class="chat-actions flex gap-4 items-center flex-shrink-0">
                        <button id="search-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="Search messages">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="More options">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messages flex-grow p-5 overflow-y-auto flex flex-col gap-5" id="messages-container">
                    <div class="text-gray-500 text-center py-4">Please sign in to view messages</div>
                </div>
                
                <div class="message-input border-t border-gray-300 p-5 flex items-center gap-3">
                    <input type="text" id="message-input" placeholder="Type your message here..." class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 transition-colors min-w-0" aria-label="Type your message">
                    <button class="send-button bg-pink-600 text-white w-12 h-12 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-500 transition-colors flex-shrink-0" id="send-button" aria-label="Send message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="search-modal hidden fixed inset-0 bg-black bg-opacity-80 z-[2000] items-center justify-center" id="search-modal">
        <div class="search-modal-content bg-white p-5 rounded-lg w-[90%] max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col">
            <div class="search-modal-header flex justify-between items-center mb-4">
                <h3 class="text-pink-600 font-semibold text-lg">Search Messages</h3>
                <button class="search-modal-close bg-transparent border-none text-2xl text-gray-600 cursor-pointer hover:text-pink-600" id="search-modal-close" aria-label="Close search">&times;</button>
            </div>
            <input type="text" class="search-modal-input w-full p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 mb-4" id="search-modal-input" placeholder="Type to search messages..." aria-label="Search messages">
            <div class="search-results max-h-[300px] overflow-y-auto no-scrollbar" id="search-results">
                <div class="text-gray-500 text-center py-4">Enter a search term to find messages</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-black text-gray-300 py-12 px-6">
        <div class="container max-w-7xl mx-auto">
            <div class="footer-main grid grid-cols-1 md:grid-cols-3 gap-12 mb-8">
                <div class="footer-left flex flex-col gap-4">
                    <div class="footer-logo-section flex items-center gap-3">
                        <img src="./img/Girls Space (1) (1) (2).png" alt="GirlsSpace Logo" class="footer-logo w-12 h-12 object-contain rounded-full border-2 border-pink-500" onerror="handleImageError(this)">
                        <p class="footer-subtitle font-semibold text-pink-400 text-base">Empowering Girls, Building Futures</p>
                    </div>
                    <p class="footer-desc text-sm text-gray-400 max-w-[360px]">
                        A safe digital haven where girls in Mahama refugee camp can connect, learn, grow, and thrive.
                    </p>
                    <div class="social-links flex gap-3">
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Quick Links</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Join Chat</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Share Story</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Programs</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Get Help</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Emergency</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Support</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Report</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom pt-6 border-t border-gray-800 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div class="footer-left-info flex flex-col gap-2">
                    <p class="text-sm">¬© 2025 GirlsSpace Mahama. <span class="text-pink-400 font-medium">Empowering girls, always.</span></p>
                    <p class="text-xs text-gray-400">Firebase Chat Application - Connected to chat-room-5c3e5</p>
                </div>
                <div class="footer-right-info text-left md:text-right">
                    <p class="text-sm">Available in: English, Fran√ßais, Kiswahili, Kinyarwanda, Arabic</p>
                    <p class="text-sm mt-1">Supported by UNHCR, Save The Children, Alight</p>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>