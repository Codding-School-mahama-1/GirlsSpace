<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat Room - Girls Space</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message { animation: fadeIn 0.3s ease; }
        body { background: radial-gradient(circle, #be185d, #e9ecef 95%); transition: background 0.5s ease; }
        .messages { background-image: url(./imge/hp1.png); background-size: cover; background-position: center; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        
        /* Audio recording styles */
        .audio-recording { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Theme colors */
        .theme-pink { --primary-color: #ec4899; --secondary-color: #f472b6; }
        .theme-blue { --primary-color: #3b82f6; --secondary-color: #60a5fa; }
        .theme-purple { --primary-color: #8b5cf6; --secondary-color: #a78bfa; }
        .theme-green { --primary-color: #10b981; --secondary-color: #34d399; }
        
        /* Video call styles */
        .video-call-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .video-call-container { backdrop-filter: blur(10px); }
        
        /* Language translation styles */
        .translation-active { border: 2px solid #3b82f6 !important; }
        
        /* Custom Auth Modal Styles */
        .auth-modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 0.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            background: none;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            color: #6b7280;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            color: #ec4899;
            background-color: #fdf2f8;
            box-shadow: 0 2px 4px rgba(236, 72, 153, 0.2);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .forgot-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .forgot-link:hover {
            text-decoration: underline;
        }
        
        .success-message {
            color: #10b981;
            background-color: #d1fae5;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            display: none;
        }
        
        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .password-input {
            position: relative;
        }
        
        .form-input {
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }
        
        .form-button {
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .divider {
            margin: 1rem 0;
            font-size: 0.875rem;
        }
        
        .login-modal {
            padding: 1rem;
            align-items: flex-start;
            padding-top: 5vh;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden theme-pink">
    <!-- Login Modal -->
    <div class="login-modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[2000] hidden" id="login-modal">
        <!-- Content will be dynamically generated by AuthModalManager -->
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-[2001] flex items-center justify-center">
        <div class="settings-content bg-white p-6 rounded-2xl w-[90%] max-w-[400px] shadow-2xl">
            <div class="settings-header flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Settings</h3>
                <button id="settings-close" class="text-2xl text-gray-600 hover:text-gray-800">&times;</button>
            </div>
            
            <div class="settings-body">
                <div class="theme-section mb-6">
                    <h4 class="font-semibold text-gray-700 mb-3">Theme Color</h4>
                    <div class="theme-colors flex gap-3">
                        <button class="theme-option w-10 h-10 bg-pink-500 rounded-full hover:opacity-90 border-2 border-blue-500" data-theme="theme-pink"></button>
                        <button class="theme-option w-10 h-10 bg-blue-500 rounded-full hover:opacity-90" data-theme="theme-blue"></button>
                        <button class="theme-option w-10 h-10 bg-purple-500 rounded-full hover:opacity-90" data-theme="theme-purple"></button>
                        <button class="theme-option w-10 h-10 bg-green-500 rounded-full hover:opacity-90" data-theme="theme-green"></button>
                    </div>
                </div>
                
                <div class="signout-section">
                    <button id="signout-btn" class="w-full py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                        <i class="fas fa-sign-out-alt mr-2"></i> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Call Modal -->
    <div id="video-call-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-[2002] flex items-center justify-center p-4">
        <div class="video-call-container bg-gray-900 rounded-2xl w-full max-w-4xl h-[80vh] overflow-hidden flex flex-col">
            <div class="video-header bg-gray-800 p-4 flex justify-between items-center">
                <h3 class="text-white font-semibold">Video Call</h3>
                <button id="end-call-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                    <i class="fas fa-phone-slash mr-2"></i> End Call
                </button>
            </div>
            <div class="video-content flex-grow flex">
                <div class="remote-video flex-grow bg-black">
                    <video id="remote-video" autoplay class="w-full h-full object-cover"></video>
                </div>
                <div class="local-video absolute bottom-4 right-4 w-48 h-32 bg-black rounded-lg shadow-lg overflow-hidden">
                    <video id="local-video" autoplay muted class="w-full h-full object-cover"></video>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Call Modal -->
    <div id="audio-call-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-[2002] flex items-center justify-center">
        <div class="audio-call-container bg-gray-800 rounded-2xl p-8 max-w-md text-center">
            <div class="audio-icon text-white text-6xl mb-6">
                <i class="fas fa-phone-alt"></i>
            </div>
            <h3 class="text-white text-2xl font-semibold mb-2">Audio Call</h3>
            <p class="text-gray-300 mb-6">Connected to user</p>
            <div class="call-controls">
                <button id="end-audio-call-btn" class="px-6 py-3 bg-red-600 text-white rounded-full hover:bg-red-700">
                    <i class="fas fa-phone-slash text-xl"></i>
                </button>
            </div>
            <audio id="local-audio" autoplay muted></audio>
            <audio id="remote-audio" autoplay></audio>
        </div>
    </div>

    <!-- Modern Navigation -->
    <nav class="navbar sticky top-0 z-[1000] bg-white shadow-md px-4 py-3 md:px-10 flex flex-wrap items-center justify-between">
        <div class="nav-logo">
            <img src="./img/Girls Space (1) (1) (2).png" alt="Logo" class="w-16 h-12 object-contain rounded-full max-w-full" onerror="handleImageError(this)">
        </div>
        
        <div class="hamburger flex flex-col gap-1 cursor-pointer z-[1001] md:hidden">
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-opacity"></span>
            <span class="w-7 h-1 bg-gray-700 rounded transition-transform"></span>
        </div>
        
        <ul class="nav-links fixed top-0 left-[-100%] w-72 h-full bg-white flex flex-col gap-5 p-6 pt-20 shadow-xl transition-transform md:static md:w-auto md:h-auto md:flex-row md:items-center md:gap-4 md:p-0 md:shadow-none md:translate-x-0">
            <li><a href="./index.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="home">Home</a></li>
            <li><a href="./AboutUs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="about">About</a></li>
            <li><a href="./chat.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="chat">Chat</a></li>
            <li><a href="./stoies.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="stories">Stories</a></li>
            <li><a href="./learning_programs.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="programs">Programs</a></li>
            <li><a href="./protection.html" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full" data-translate="support">Support</a></li>
            
            <li class="dropdown relative">
                <a href="#" class="nav-link text-gray-700 font-medium hover:text-pink-500 transition-colors relative after:absolute after:bottom-[-4px] after:left-1/2 after:h-0.5 after:w-0 after:bg-gradient-to-r after:from-pink-500 after:to-pink-700 after:transition-all after:-translate-x-1/2 hover:after:w-full">Languages <i class="fas fa-chevron-down"></i></a>
                <ul class="dropdown-menu absolute top-full left-0 bg-white shadow-xl rounded-lg min-w-[130px] p-2 z-[1000] hidden">
                    <li><a href="#" class="language-option translation-active block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="en">English</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="sw">Kiswahili</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="fr">FranÃ§ais</a></li>
                    <li><a href="#" class="language-option block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600 rounded transition-colors" data-lang="rw">Kinyarwanda</a></li>
                </ul>
            </li>
            
            <!-- Fixed: Login button as separate element -->
            <li>
                <button id="nav-login-btn" class="login-btn px-4 py-2 border border-pink-500 text-pink-500 font-semibold rounded-full hover:bg-pink-50 transition-colors" data-translate="login">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login 
                </button>
            </li> 
            
            
            <li>
                <a href="./Donate.html" class="donate-btn px-5 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white font-semibold rounded-full hover:shadow-lg transition-shadow" data-translate="donate">
                    <i class="fas fa-heart mr-2"></i> Donate
                </a>
            </li>
             <!-- Fixed: Search button before Donate -->
            <li>
                <button id="nav-search-btn" class="donate-btn px-5 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold rounded-full hover:shadow-lg transition-shadow flex items-center" data-translate="search">
                    <i class="fas fa-search mr-2"></i> Search
                </button>
            </li>
            


        </ul>

        <div class="nav-overlay fixed inset-0 bg-black bg-opacity-50 hidden z-[999] md:hidden"></div>
    </nav>

    <!-- Main Content -->
    <div class="main-content flex-grow flex items-center justify-center p-5">
        <div class="chat-container w-full max-w-7xl h-[85vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row">
            <!-- Sidebar -->
            <div class="sidebar w-full md:w-1/3 lg:w-1/4 bg-pink-100 border-r border-gray-300 flex flex-col">
                <div class="sidebar-header bg-pink-600 text-white text-center p-5">
                    <h2 class="text-xl font-bold mb-1" data-translate="lets_chat">Let's Chat</h2>
                    <p class="text-sm opacity-80" data-translate="connect">Connect with fellow entrepreneurs</p>
                </div>
                
                <div class="user-profile flex items-center p-4 border-b border-gray-300">
                    <div class="user-avatar w-12 h-12 rounded-full flex items-center justify-center text-white mr-4 overflow-hidden flex-shrink-0">
                        <img src="img/girl.png" alt="User Avatar" class="w-full h-full object-cover" onerror="handleImageError(this)">
                    </div>
                    <div class="user-info flex-1 min-w-0">
                        <h3 class="font-semibold text-sm truncate" id="user-name">Guest User</h3>
                        <p class="text-xs text-gray-600 truncate" id="user-email" data-translate="sign_in">Sign in to chat</p>
                        <div class="online-status flex items-center mt-1">
                            <div class="status-dot w-2 h-2 rounded-full bg-gray-500 mr-1" id="status-dot"></div>
                            <span class="text-xs" id="status-text" data-translate="offline">Offline</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-tabs flex border-b border-gray-300">
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 bg-white text-pink-600 border-b-2 border-pink-600" data-tab="channels">Channels</div>
                    <div class="sidebar-tab flex-1 text-center py-3 cursor-pointer font-semibold text-gray-600 hover:bg-gray-50 transition-colors" data-tab="people">People</div>
                </div>
                
                <div class="channels flex-1 overflow-y-auto p-5">
                    <h3 class="text-blue-500 font-semibold text-sm mb-4 flex items-center" data-translate="discussion">
                        <i class="fas fa-hashtag mr-2"></i> Discussion Channels
                    </h3>
                    <ul class="channel-list space-y-3">
                        <li class="channel-item bg-white shadow border-l-4 border-pink-600 rounded-lg p-3 cursor-pointer transition-all hover:shadow-md flex items-center" data-channel="ideas">
                            <div class="channel-icon w-9 h-9 rounded-full bg-yellow-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate" data-translate="ideas">Ideas & Brainstorming</h4>
                                <p class="text-xs text-gray-600 truncate">23 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="support">
                            <div class="channel-icon w-9 h-9 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate" data-translate="support_desc">Q&A Support</h4>
                                <p class="text-xs text-gray-600 truncate">45 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="partnerships">
                            <div class="channel-icon w-9 h-9 rounded-full bg-green-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate" data-translate="partnerships">Partnerships</h4>
                                <p class="text-xs text-gray-600 truncate">18 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="growth">
                            <div class="channel-icon w-9 h-9 rounded-full bg-purple-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate" data-translate="growth">Growth Strategies</h4>
                                <p class="text-xs text-gray-600 truncate">32 members</p>
                            </div>
                        </li>
                        <li class="channel-item rounded-lg p-3 cursor-pointer transition-all hover:bg-white hover:shadow-md flex items-center" data-channel="resources">
                            <div class="channel-icon w-9 h-9 rounded-full bg-red-500 text-white flex items-center justify-center text-sm mr-3 flex-shrink-0">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="channel-info flex-1 min-w-0">
                                <h4 class="font-semibold text-sm text-black truncate" data-translate="resources">Student Resources</h4>
                                <p class="text-xs text-gray-600 truncate">56 members</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Chat Area -->
            <div class="chat-area flex-grow flex flex-col min-w-0">
                <div class="chat-header bg-gray-50 border-b border-gray-300 p-5 flex items-center justify-between">
                    <div class="chat-title flex-1 min-w-0">
                        <h2 id="channel-title" class="text-blue-500 text-lg font-semibold truncate">#ideas</h2>
                        <p id="channel-description" class="text-xs text-gray-600 mt-1 truncate" data-translate="share_ideas">Share and discuss business ideas with the community</p>
                    </div>
                    <div class="chat-actions flex gap-4 items-center flex-shrink-0">
                        <!-- Video Call Button -->
                        <button id="video-call-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-green-600 transition-colors cursor-pointer" aria-label="Start video call">
                            <i class="fas fa-video"></i>
                        </button>
                        
                        <!-- Audio Call Button -->
                        <button id="audio-call-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-blue-600 transition-colors cursor-pointer" aria-label="Start audio call">
                            <i class="fas fa-phone-alt"></i>
                        </button>
                        
                        <!-- Settings Button -->
                        <button id="settings-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        
                        <!-- Search Button -->
                        <button id="search-btn" class="bg-transparent border-none text-gray-600 text-xl hover:text-pink-600 transition-colors cursor-pointer" aria-label="Search messages">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messages flex-grow p-5 overflow-y-auto flex flex-col gap-5" id="messages-container">
                    <div class="text-center py-8">
                        <div class="text-pink-600 text-xl font-semibold mb-2" data-translate="welcome">Welcome to Girls Chat</div>
                        <p class="text-gray-600 mb-4">Please sign in to join the conversation</p>
                        <button id="chat-login-btn" class="px-6 py-2 bg-pink-600 text-white rounded-full hover:bg-pink-700 transition-colors">
                            Sign In to Continue
                        </button>
                    </div>
                </div>
                
                <div class="message-input border-t border-gray-300 p-5 flex items-center gap-3">
                    <!-- Media Upload Buttons -->
                    <div class="media-buttons flex gap-2">
                        <!-- Photo Upload -->
                        <label for="photo-upload" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-500 transition-colors flex-shrink-0">
                            <i class="fas fa-camera"></i>
                            <input type="file" id="photo-upload" accept="image/*" class="hidden">
                        </label>
                        
                        <!-- Video Upload -->
                        <label for="video-upload" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-purple-500 transition-colors flex-shrink-0">
                            <i class="fas fa-video"></i>
                            <input type="file" id="video-upload" accept="video/*" class="hidden">
                        </label>
                        
                        <!-- Audio Recording -->
                        <button id="audio-record" class="media-button bg-gray-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-red-500 transition-colors flex-shrink-0 relative">
                            <i class="fas fa-microphone" id="audio-recording"></i>
                            <span id="audio-indicator" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                        </button>
                    </div>
                    
                    <!-- Message Input -->
                    <input type="text" id="message-input" placeholder="Type your message here..." class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 transition-colors min-w-0" aria-label="Type your message" disabled>
                    
                    <!-- Send Button -->
                    <button class="send-button bg-pink-600 text-white w-12 h-12 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-500 transition-colors flex-shrink-0" id="send-button" aria-label="Send message" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="search-modal hidden fixed inset-0 bg-black bg-opacity-80 z-[2000] items-center justify-center" id="search-modal">
        <div class="search-modal-content bg-white p-5 rounded-lg w-[90%] max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col">
            <div class="search-modal-header flex justify-between items-center mb-4">
                <h3 class="text-pink-600 font-semibold text-lg">Search Messages</h3>
                <button class="search-modal-close bg-transparent border-none text-2xl text-gray-600 cursor-pointer hover:text-pink-600" id="search-modal-close" aria-label="Close search">&times;</button>
            </div>
            <input type="text" class="search-modal-input w-full p-3 border border-gray-300 rounded-full focus:outline-none focus:border-pink-500 mb-4" id="search-modal-input" placeholder="Type to search messages..." aria-label="Search messages">
            <div class="search-results max-h-[300px] overflow-y-auto no-scrollbar" id="search-results">
                <div class="text-gray-500 text-center py-4">Enter a search term to find messages</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-black text-gray-300 py-12 px-6">
        <div class="container max-w-7xl mx-auto">
            <div class="footer-main grid grid-cols-1 md:grid-cols-3 gap-12 mb-8">
                <div class="footer-left flex flex-col gap-4">
                    <div class="footer-logo-section flex items-center gap-3">
                        <img src="./img/Girls Space (1) (1) (2).png" alt="GirlsSpace Logo" class="footer-logo w-12 h-12 object-contain rounded-full border-2 border-pink-500" onerror="handleImageError(this)">
                        <p class="footer-subtitle font-semibold text-pink-400 text-base">Empowering Girls, Building Futures</p>
                    </div>
                    <p class="footer-desc text-sm text-gray-400 max-w-[360px]">
                        A safe digital haven where girls in Mahama refugee camp can connect, learn, grow, and thrive.
                    </p>
                    <div class="social-links flex gap-3">
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-btn w-10 h-10 bg-gray-800 border border-gray-700 rounded-lg flex items-center justify-center text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-300" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Quick Links</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Join Chat</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Share Story</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Programs</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4 class="links-title text-white font-semibold text-lg mb-4">Get Help</h4>
                    <ul class="links-list space-y-3">
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Emergency</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Support</a></li>
                        <li><a href="#" class="link-item text-gray-400 hover:text-pink-400 transition-colors text-sm">Report</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom pt-6 border-t border-gray-800 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div class="footer-left-info flex flex-col gap-2">
                    <p class="text-sm">Â© 2025 GirlsSpace Mahama. <span class="text-pink-400 font-medium">Empowering girls, always.</span></p>
                    <p class="text-xs text-gray-400">Firebase Chat Application - Connected to chat-room-5c3e5</p>
                </div>
                <div class="footer-right-info text-left md:text-right">
                    <p class="text-sm">Available in: English, FranÃ§ais, Kiswahili, Kinyarwanda, Arabic</p>
                    <p class="text-sm mt-1">Supported by UNHCR, Save The Children, Alight</p>
                </div>
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            signOut,
            onAuthStateChanged,
            sendPasswordResetEmail,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            orderBy,
            onSnapshot,
            serverTimestamp,
            getDocs
        } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC5_OQUVnBC1BE_0C4At39xSR0pHBp-wws",
            authDomain: "chat-room-5c3e5.firebaseapp.com",
            projectId: "chat-room-5c3e5",
            storageBucket: "chat-room-5c3e5.firebasestorage.app",
            messagingSenderId: "637694009856",
            appId: "1:637694009856:web:8de78eda815ac24d3daee5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        console.log("ğŸ”¥ Firebase initialized with project: chat-room-5c3e5");

        // Global variables
        let currentUser = null;
        let currentChannel = 'ideas';
        let unsubscribeMessages = null;
        let currentLang = 'en';
        let currentTheme = 'theme-pink';
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        // Complete translations including French and Kinyarwanda
        let translations = {
            'en': {
                'login': 'Login',
                'logout': 'Logout',
                'donate': 'Donate',
                'home': 'Home',
                'about': 'About',
                'chat': 'Chat',
                'stories': 'Stories',
                'programs': 'Programs',
                'support': 'Support',
                'welcome': 'Welcome to Girls Chat',
                'type_message': 'Type your message here...',
                'search': 'Search',
                'sign_in': 'Sign in to chat',
                'online': 'Online',
                'offline': 'Offline',
                'send': 'Send Message',
                'ideas': 'Ideas & Brainstorming',
                'support_desc': 'Q&A Support',
                'partnerships': 'Partnerships',
                'growth': 'Growth Strategies',
                'resources': 'Student Resources',
                'discussion': 'Discussion Channels',
                'lets_chat': 'Let\'s Chat',
                'connect': 'Connect with fellow entrepreneurs',
                'share_ideas': 'Share and discuss business ideas with the community',
                'get_answers': 'Get answers to your questions and help others',
                'find_partners': 'Find collaborators and business partners',
                'discuss_strategies': 'Discuss strategies for scaling your business',
                'discover_resources': 'Share and discover helpful student resources',
                'sign_in_tab': 'Sign In',
                'create_account_tab': 'Create Account',
                'forgot_password_tab': 'Forgot Password',
                'name': 'Full Name',
                'email': 'Email Address',
                'password': 'Password',
                'confirm_password': 'Confirm Password',
                'forgot_password': 'Forgot Password?',
                'reset_password': 'Reset Password',
                'back_to_login': 'Back to Sign In',
                'password_reset_sent': 'Password reset email sent! Check your inbox.',
                'account_created': 'Account created successfully!',
                'password_min_length': 'Password must be at least 6 characters',
                'passwords_not_match': 'Passwords do not match',
                'enter_valid_email': 'Please enter a valid email',
                'fill_all_fields': 'Please fill in all fields'
            },
            'ar': {
                'login': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                'logout': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
                'donate': 'ØªØ¨Ø±Ø¹',
                'home': 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
                'about': 'Ø¹Ù†Ø§',
                'chat': 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©',
                'stories': 'Ø§Ù„Ù‚ØµØµ',
                'programs': 'Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬',
                'support': 'Ø§Ù„Ø¯Ø¹Ù…',
                'welcome': 'Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ÙØªÙŠØ§Øª',
                'type_message': 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...',
                'search': 'Ø¨Ø­Ø«',
                'sign_in': 'Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©',
                'online': 'Ù…ØªØµÙ„',
                'offline': 'ØºÙŠØ± Ù…ØªØµÙ„',
                'send': 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©',
                'ideas': 'Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„Ø¹ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠ',
                'support_desc': 'Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª',
                'partnerships': 'Ø§Ù„Ø´Ø±Ø§ÙƒØ§Øª',
                'growth': 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ù†Ù…Ùˆ',
                'resources': 'Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨',
                'discussion': 'Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©',
                'lets_chat': 'Ù„Ù†ØªØ­Ø¯Ø«',
                'connect': 'ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø±Ø§Ø¦Ø¯Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø£Ø®Ø±ÙŠØ§Øª',
                'share_ideas': 'Ø´Ø§Ø±Ùƒ ÙˆÙ†Ø§Ù‚Ø´ Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹',
                'get_answers': 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆØ³Ø§Ø¹Ø¯ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†',
                'find_partners': 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ØªØ¹Ø§ÙˆÙ†ÙŠÙ† ÙˆØ´Ø±ÙƒØ§Ø¡ Ø¹Ù…Ù„',
                'discuss_strategies': 'Ù†Ø§Ù‚Ø´ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªÙˆØ³ÙŠØ¹ Ø¹Ù…Ù„Ùƒ',
                'discover_resources': 'Ø´Ø§Ø±Ùƒ ÙˆØ§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ§Ø±Ø¯ Ù…ÙÙŠØ¯Ø© Ù„Ù„Ø·Ù„Ø§Ø¨',
                'sign_in_tab': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                'create_account_tab': 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨',
                'forgot_password_tab': 'Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                'name': 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
                'email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                'confirm_password': 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                'forgot_password': 'Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ',
                'reset_password': 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                'back_to_login': 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                'password_reset_sent': 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'account_created': 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!',
                'password_min_length': 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
                'passwords_not_match': 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©',
                'enter_valid_email': 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ§Ù„Ø­',
                'fill_all_fields': 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'
            },
            'sw': {
                'login': 'Ingia',
                'logout': 'Toka',
                'donate': 'Changia',
                'home': 'Nyumbani',
                'about': 'Kuhusu',
                'chat': 'Mazungumzo',
                'stories': 'Hadithi',
                'programs': 'Mipango',
                'support': 'Usaidizi',
                'welcome': 'Karibu kwenye Mazungumzo ya Wasichana',
                'type_message': 'Andika ujumbe wako hapa...',
                'search': 'Tafuta',
                'sign_in': 'Ingia kuzungumza',
                'online': 'Mtandaoni',
                'offline': 'Nje ya mtandao',
                'send': 'Tuma Ujumbe',
                'ideas': 'Mawazo na Uundaji wa Mawazo',
                'support_desc': 'Maswali na Majibu',
                'partnerships': 'Ushirikiano',
                'growth': 'Mikakati ya Ukuaji',
                'resources': 'Rasilimali za Wanafunzi',
                'discussion': 'Vituo vya Majadiliano',
                'lets_chat': 'Tuzungumze',
                'connect': 'Wasiliana na wajasiriamali wenza',
                'share_ideas': 'Shiriki na zungumza mawazo ya biashara na jamii',
                'get_answers': 'Pata majibu ya maswali yako na usaidie wengine',
                'find_partners': 'Tafuta washirika na wafanyabiashara',
                'discuss_strategies': 'Zungumza mikakati ya kuongeza ukubwa wa biashara yako',
                'discover_resources': 'Shiriki na gundua rasilimali muhimu kwa wanafunzi',
                'sign_in_tab': 'Ingia',
                'create_account_tab': 'Unda Akaunti',
                'forgot_password_tab': 'Umesahau Nenosiri',
                'name': 'Jina Kamili',
                'email': 'Barua Pepe',
                'password': 'Nenosiri',
                'confirm_password': 'Thibitisha Nenosiri',
                'forgot_password': 'Umesahau nenosiri?',
                'reset_password': 'Weka Upya Nenosiri',
                'back_to_login': 'Rudi Kwenye Kuingia',
                'password_reset_sent': 'Barua pepe ya kuweka upya nenosiri imetumwa! Angalia kikasha chako.',
                'account_created': 'Akaunti imeundwa kwa mafanikio!',
                'password_min_length': 'Nenosiri lazima liwe na herufi 6 angalau',
                'passwords_not_match': 'Nenosiri halifanani',
                'enter_valid_email': 'Tafadhali ingiza barua pepe sahihi',
                'fill_all_fields': 'Tafadhali jaza sehemu zote'
            },
            'fr': {
                'login': 'Connexion',
                'logout': 'DÃ©connexion',
                'donate': 'Faire un don',
                'home': 'Accueil',
                'about': 'Ã€ propos',
                'chat': 'Chat',
                'stories': 'Histoires',
                'programs': 'Programmes',
                'support': 'Soutien',
                'welcome': 'Bienvenue dans le Chat des Filles',
                'type_message': 'Tapez votre message ici...',
                'search': 'Rechercher',
                'sign_in': 'Connectez-vous pour chatter',
                'online': 'En ligne',
                'offline': 'Hors ligne',
                'send': 'Envoyer le message',
                'ideas': 'IdÃ©es & Brainstorming',
                'support_desc': 'Support Q&A',
                'partnerships': 'Partenariats',
                'growth': 'StratÃ©gies de croissance',
                'resources': 'Ressources pour Ã©tudiants',
                'discussion': 'Canaux de discussion',
                'lets_chat': 'Discutons',
                'connect': 'Connectez-vous avec d\'autres entrepreneures',
                'share_ideas': 'Partagez et discutez des idÃ©es d\'entreprise avec la communautÃ©',
                'get_answers': 'Obtenez des rÃ©ponses Ã  vos questions et aidez les autres',
                'find_partners': 'Trouvez des collaborateurs et partenaires commerciaux',
                'discuss_strategies': 'Discutez des stratÃ©gies pour dÃ©velopper votre entreprise',
                'discover_resources': 'Partagez et dÃ©couvrez des ressources utiles pour les Ã©tudiants',
                'sign_in_tab': 'Se connecter',
                'create_account_tab': 'CrÃ©er un compte',
                'forgot_password_tab': 'Mot de passe oubliÃ©',
                'name': 'Nom complet',
                'email': 'Adresse email',
                'password': 'Mot de passe',
                'confirm_password': 'Confirmer le mot de passe',
                'forgot_password': 'Mot de passe oubliÃ© ?',
                'reset_password': 'RÃ©initialiser le mot de passe',
                'back_to_login': 'Retour Ã  la connexion',
                'password_reset_sent': 'Email de rÃ©initialisation envoyÃ© ! VÃ©rifiez votre boÃ®te de rÃ©ception.',
                'account_created': 'Compte crÃ©Ã© avec succÃ¨s !',
                'password_min_length': 'Le mot de passe doit comporter au moins 6 caractÃ¨res',
                'passwords_not_match': 'Les mots de passe ne correspondent pas',
                'enter_valid_email': 'Veuillez saisir un email valide',
                'fill_all_fields': 'Veuillez remplir tous les champs'
            },
            'rw': {
                'login': 'Injira',
                'logout': 'Sohoka',
                'donate': 'Tanga',
                'home': 'Ahabanza',
                'about': 'Ibyerekeye',
                'chat': 'Kuganira',
                'stories': 'Inkuru',
                'programs': 'Porogaramu',
                'support': 'Gushigikira',
                'welcome': 'Murakaza neza mu Kuganira kwa Abakobwa',
                'type_message': 'Andika ubutumwa bwawe hano...',
                'search': 'Shakisha',
                'sign_in': 'Injira kuganira',
                'online': 'Kuri interineti',
                'offline': 'Nta interineti',
                'send': 'Ohereza Ubutumwa',
                'ideas': 'Ibitekerezo n\'Ibisubizo',
                'support_desc': 'Ibibazo n\'Ibisubizo',
                'partnerships': 'Ubusabane',
                'growth': 'Uburyo Bwo Kongera',
                'resources': 'Ibikoresho by\'Abanyeshuri',
                'discussion': 'Inzira zo Kuganira',
                'lets_chat': 'Reka Tuvugane',
                'connect': 'Wunganire n\'abandi bashoramari',
                'share_ideas': 'Sangiza kandi ujye uvuga ibitekerezo bya business muri sosiyete',
                'get_answers': 'Shakira ibisubizo by\'ibibazo byawe kandi unafashe abandi',
                'find_partners': 'Shaka abafatanyabikorwa n\'inshuti mu business',
                'discuss_strategies': 'Vuga ku mabwiriza yo kongera ubunini bw\'ubucuruzi bwawe',
                'discover_resources': 'Sangiza kandi ushakishe ibikoresho by\'ingenzi ku banyeshuri',
                'sign_in_tab': 'Injira',
                'create_account_tab': 'Kora Konti',
                'forgot_password_tab': 'Wibagiwe ijambobanga',
                'name': 'Amazina yuzuye',
                'email': 'Aderesi ya Email',
                'password': 'Ijambobanga',
                'confirm_password': 'Emeza Ijambobanga',
                'forgot_password': 'Wibagiwe ijambobanga?',
                'reset_password': 'Ongera ushyiremo ijambobanga',
                'back_to_login': 'Subira mu kwinjira',
                'password_reset_sent': 'Email yo gusubiramo ijambobanga yoherejwe! Reba mu sanduku yawe ya email.',
                'account_created': 'Konti yahanze neza!',
                'password_min_length': 'Ijambobanga rigomba kugira inyuguti 6 byibuze',
                'passwords_not_match': 'Ijambobanga ntibihuye',
                'enter_valid_email': 'Nyamuneka shyiramo email nziza',
                'fill_all_fields': 'Nyamuneka uzuze imirongo yose'
            }
        };

        // DOM Elements
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const searchBtn = document.getElementById('search-btn');
        const searchModal = document.getElementById('search-modal');
        const searchModalInput = document.getElementById('search-modal-input');
        const searchResults = document.getElementById('search-results');
        const channelTitle = document.getElementById('channel-title');
        const channelDescription = document.getElementById('channel-description');
        const loginModal = document.getElementById('login-modal');
        const userNameElement = document.getElementById('user-name');
        const userEmailElement = document.getElementById('user-email');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');

        // Image error handler
        function handleImageError(img) {
            img.onerror = null;
            img.src = 'https://ui-avatars.com/api/?name=User&background=ec4899&color=fff';
        }

        // Auth Modal Manager
        class AuthModalManager {
            constructor() {
                this.currentTab = 'signin';
                this.createAuthModal();
                this.setupTabSwitching();
            }
            
            createAuthModal() {
                const loginModal = document.getElementById('login-modal');
                if (loginModal) {
                    loginModal.innerHTML = `
                        <div class="auth-modal-content">
                            <h2 class="text-pink-600 text-center text-xl font-bold mb-4">Welcome to Girls Chat</h2>
                            
                            <button id="google-login-btn" class="w-full py-2 bg-blue-600 text-white rounded-lg mb-3 flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors text-sm">
                                <i class="fab fa-google"></i> Sign in with Google
                            </button>
                            
                            <div class="divider relative my-4 text-center text-gray-600 text-sm">
                                <span class="bg-white px-3 relative z-10">or</span>
                                <div class="absolute top-1/2 left-0 right-0 h-px bg-gray-300 -translate-y-1/2 z-0"></div>
                            </div>
                            
                            <div class="auth-tabs">
                                <button class="auth-tab active" data-tab="signin">Sign In</button>
                                <button class="auth-tab" data-tab="signup">Create Account</button>
                                <button class="auth-tab" data-tab="forgot">Forgot Password</button>
                            </div>
                            
                            <!-- Sign In Form -->
                            <form id="signin-form" class="auth-form active">
                                <div class="mb-3">
                                    <input type="email" id="signin-email" placeholder="Email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                                </div>
                                <div class="mb-3 password-input">
                                    <input type="password" id="signin-password" placeholder="Password" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                                        <i class="far fa-eye text-sm"></i>
                                    </button>
                                </div>
                                <button type="submit" id="signin-submit" class="w-full py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium mb-2 text-sm">Sign In</button>
                                <div class="text-center">
                                    <a class="forgot-link text-xs" onclick="this.closest('.auth-modal-content').querySelector('[data-tab=\"forgot\"]').click()">Forgot Password?</a>
                                </div>
                            </form>
                            
                            <!-- Sign Up Form -->
                            <form id="signup-form" class="auth-form">
                                <div class="mb-3">
                                    <input type="text" id="signup-name" placeholder="Full Name" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                                </div>
                                <div class="mb-3">
                                    <input type="email" id="signup-email" placeholder="Email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                                </div>
                                <div class="mb-3 password-input">
                                    <input type="password" id="signup-password" placeholder="Password (min 6 characters)" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                                        <i class="far fa-eye text-sm"></i>
                                    </button>
                                </div>
                                <div class="mb-3 password-input">
                                    <input type="password" id="signup-confirm-password" placeholder="Confirm Password" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 pr-10 text-sm">
                                    <button type="button" class="password-toggle" onclick="this.parentNode.querySelector('input').type = this.parentNode.querySelector('input').type === 'password' ? 'text' : 'password'">
                                        <i class="far fa-eye text-sm"></i>
                                    </button>
                                </div>
                                <button type="submit" id="signup-submit" class="w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium text-sm">Create Account</button>
                            </form>
                            
                            <!-- Forgot Password Form -->
                            <form id="forgot-form" class="auth-form">
                                <div class="mb-3">
                                    <input type="email" id="forgot-email" placeholder="Enter your email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm">
                                </div>
                                <button type="submit" id="forgot-submit" class="w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium mb-2 text-sm">Reset Password</button>
                                <div class="text-center">
                                    <a class="forgot-link text-xs" onclick="this.closest('.auth-modal-content').querySelector('[data-tab=\"signin\"]').click()">Back to Sign In</a>
                                </div>
                            </form>
                            
                            <div id="auth-success" class="success-message"></div>
                            <div id="auth-error" class="text-red-500 text-center mt-2 min-h-[20px] text-xs hidden"></div>
                            
                            <p class="text-xs text-gray-600 mt-4 text-center">
                                By signing in, you agree to our Terms of Service and Privacy Policy
                            </p>
                        </div>
                    `;
                }
            }
            
            setupTabSwitching() {
                // Tab switching
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.getAttribute('data-tab');
                        this.switchTab(tabId);
                    });
                });
                
                // Form submissions
                document.getElementById('signin-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSignIn();
                });
                
                document.getElementById('signup-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSignUp();
                });
                
                document.getElementById('forgot-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleForgotPassword();
                });
                
                // Google login
                document.getElementById('google-login-btn')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.handleGoogleLogin();
                });
            }
            
            switchTab(tabId) {
                this.currentTab = tabId;
                
                // Update active tab
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });
                
                // Update active form
                document.querySelectorAll('.auth-form').forEach(form => {
                    form.classList.toggle('active', form.id === `${tabId}-form`);
                });
                
                // Clear messages
                this.clearMessages();
            }
            
            clearMessages() {
                const errorDiv = document.getElementById('auth-error');
                const successDiv = document.getElementById('auth-success');
                if (errorDiv) {
                    errorDiv.classList.add('hidden');
                    errorDiv.textContent = '';
                }
                if (successDiv) {
                    successDiv.style.display = 'none';
                    successDiv.textContent = '';
                }
            }
            
            showError(message) {
                const errorDiv = document.getElementById('auth-error');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.classList.remove('hidden');
                    
                    setTimeout(() => {
                        errorDiv.textContent = '';
                        errorDiv.classList.add('hidden');
                    }, 5000);
                }
            }
            
            showSuccess(message) {
                const successDiv = document.getElementById('auth-success');
                if (successDiv) {
                    successDiv.textContent = message;
                    successDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        successDiv.style.display = 'none';
                        successDiv.textContent = '';
                    }, 5000);
                }
            }
            
            async handleGoogleLogin() {
                try {
                    const btn = document.getElementById('google-login-btn');
                    const originalText = btn.innerHTML;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                    
                    await window.authManager.loginWithGoogle();
                    
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                } catch (error) {
                    const btn = document.getElementById('google-login-btn');
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fab fa-google"></i> Sign in with Google';
                    this.showError("Google login failed: " + error.message);
                }
            }
            
            async handleSignIn() {
                const email = document.getElementById('signin-email')?.value.trim();
                const password = document.getElementById('signin-password')?.value;
                
                if (!email || !password) {
                    this.showError("Please fill in all fields");
                    return;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.showError("Please enter a valid email");
                    return;
                }
                
                if (password.length < 6) {
                    this.showError("Password must be at least 6 characters");
                    return;
                }
                
                try {
                    const btn = document.getElementById('signin-submit');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
                    
                    await window.authManager.loginWithEmail(email, password);
                    
                    btn.disabled = false;
                    btn.textContent = originalText;
                    
                } catch (error) {
                    const btn = document.getElementById('signin-submit');
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = "Sign In";
                    }
                }
            }
            
            async handleSignUp() {
                const name = document.getElementById('signup-name')?.value.trim();
                const email = document.getElementById('signup-email')?.value.trim();
                const password = document.getElementById('signup-password')?.value;
                const confirmPassword = document.getElementById('signup-confirm-password')?.value;
                
                if (!name || !email || !password || !confirmPassword) {
                    this.showError("Please fill in all fields");
                    return;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.showError("Please enter a valid email");
                    return;
                }
                
                if (password.length < 6) {
                    this.showError("Password must be at least 6 characters");
                    return;
                }
                
                if (password !== confirmPassword) {
                    this.showError("Passwords do not match");
                    return;
                }
                
                try {
                    const btn = document.getElementById('signup-submit');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                    
                    await window.authManager.signupWithEmail(email, password, name);
                    this.showSuccess("Account created successfully!");
                    
                    // Switch to sign in tab after successful registration
                    setTimeout(() => {
                        this.switchTab('signin');
                        document.getElementById('signin-email').value = email;
                        document.getElementById('signin-password').value = '';
                    }, 2000);
                    
                    btn.disabled = false;
                    btn.textContent = originalText;
                    
                } catch (error) {
                    const btn = document.getElementById('signup-submit');
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = "Create Account";
                    }
                }
            }
            
            async handleForgotPassword() {
                const email = document.getElementById('forgot-email')?.value.trim();
                
                if (!email) {
                    this.showError("Please enter your email");
                    return;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.showError("Please enter a valid email");
                    return;
                }
                
                try {
                    const btn = document.getElementById('forgot-submit');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                    
                    await window.authManager.resetPassword(email);
                    this.showSuccess("Password reset email sent! Check your inbox.");
                    
                    btn.disabled = false;
                    btn.textContent = originalText;
                    
                } catch (error) {
                    const btn = document.getElementById('forgot-submit');
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = "Reset Password";
                    }
                }
            }
        }

        // Media Manager
        class MediaManager {
            constructor() {
                this.setupMediaListeners();
            }
            
            setupMediaListeners() {
                // Photo upload
                const photoUpload = document.getElementById('photo-upload');
                if (photoUpload) {
                    photoUpload.addEventListener('change', (e) => this.handlePhotoUpload(e));
                }
                
                // Video upload
                const videoUpload = document.getElementById('video-upload');
                if (videoUpload) {
                    videoUpload.addEventListener('change', (e) => this.handleVideoUpload(e));
                }
                
                // Audio recording
                const audioRecord = document.getElementById('audio-record');
                if (audioRecord) {
                    audioRecord.addEventListener('click', () => this.toggleAudioRecording());
                }
                
                // Video call
                const videoCallBtn = document.getElementById('video-call-btn');
                if (videoCallBtn) {
                    videoCallBtn.addEventListener('click', () => this.startVideoCall());
                }
                
                // Audio call
                const audioCallBtn = document.getElementById('audio-call-btn');
                if (audioCallBtn) {
                    audioCallBtn.addEventListener('click', () => this.startAudioCall());
                }
                
                // End call buttons
                const endCallBtn = document.getElementById('end-call-btn');
                if (endCallBtn) {
                    endCallBtn.addEventListener('click', () => this.endVideoCall());
                }
                
                const endAudioCallBtn = document.getElementById('end-audio-call-btn');
                if (endAudioCallBtn) {
                    endAudioCallBtn.addEventListener('click', () => this.endAudioCall());
                }
            }
            
            handlePhotoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (window.chatManager) {
                        window.chatManager.sendMediaMessage({
                            type: 'photo',
                            url: e.target.result,
                            caption: 'Shared a photo'
                        });
                    }
                };
                reader.readAsDataURL(file);
            }
            
            handleVideoUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('video/')) {
                    alert('Please select a video file');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (window.chatManager) {
                        window.chatManager.sendMediaMessage({
                            type: 'video',
                            url: e.target.result,
                            caption: 'Shared a video'
                        });
                    }
                };
                reader.readAsDataURL(file);
            }
            
            async toggleAudioRecording() {
                if (!isRecording) {
                    await this.startAudioRecording();
                } else {
                    this.stopAudioRecording();
                }
            }
            
            async startAudioRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        if (window.chatManager) {
                            window.chatManager.sendMediaMessage({
                                type: 'audio',
                                url: audioUrl,
                                caption: 'Sent an audio message'
                            });
                        }
                        
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    const audioRecording = document.getElementById('audio-recording');
                    const audioIndicator = document.getElementById('audio-indicator');
                    if (audioRecording) {
                        audioRecording.classList.add('audio-recording', 'bg-red-500');
                        audioRecording.classList.remove('bg-gray-600');
                    }
                    if (audioIndicator) {
                        audioIndicator.classList.remove('hidden');
                    }
                    
                } catch (error) {
                    console.error('Error starting audio recording:', error);
                    alert('Could not access microphone. Please check permissions.');
                }
            }
            
            stopAudioRecording() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;
                    
                    const audioRecording = document.getElementById('audio-recording');
                    const audioIndicator = document.getElementById('audio-indicator');
                    if (audioRecording) {
                        audioRecording.classList.remove('audio-recording', 'bg-red-500');
                        audioRecording.classList.add('bg-gray-600');
                    }
                    if (audioIndicator) {
                        audioIndicator.classList.add('hidden');
                    }
                }
            }
            
            async startVideoCall() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: true, 
                        audio: true 
                    });
                    
                    const localVideo = document.getElementById('local-video');
                    const videoCallModal = document.getElementById('video-call-modal');
                    
                    if (localVideo) {
                        localVideo.srcObject = stream;
                    }
                    
                    if (videoCallModal) {
                        videoCallModal.classList.remove('hidden');
                    }
                    
                } catch (error) {
                    console.error('Error starting video call:', error);
                    alert('Could not access camera/microphone. Please check permissions.');
                }
            }
            
            async startAudioCall() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    const localAudio = document.getElementById('local-audio');
                    const audioCallModal = document.getElementById('audio-call-modal');
                    
                    if (localAudio) {
                        localAudio.srcObject = stream;
                    }
                    
                    if (audioCallModal) {
                        audioCallModal.classList.remove('hidden');
                    }
                    
                } catch (error) {
                    console.error('Error starting audio call:', error);
                    alert('Could not access microphone. Please check permissions.');
                }
            }
            
            endVideoCall() {
                const localVideo = document.getElementById('local-video');
                const videoCallModal = document.getElementById('video-call-modal');
                
                if (localVideo && localVideo.srcObject) {
                    localVideo.srcObject.getTracks().forEach(track => track.stop());
                }
                if (videoCallModal) {
                    videoCallModal.classList.add('hidden');
                }
            }
            
            endAudioCall() {
                const localAudio = document.getElementById('local-audio');
                const audioCallModal = document.getElementById('audio-call-modal');
                
                if (localAudio && localAudio.srcObject) {
                    localAudio.srcObject.getTracks().forEach(track => track.stop());
                }
                if (audioCallModal) {
                    audioCallModal.classList.add('hidden');
                }
            }
        }

        // Theme Manager
        class ThemeManager {
            constructor() {
                this.currentTheme = localStorage.getItem('chat-theme') || 'theme-pink';
                this.applyTheme(this.currentTheme);
                this.setupThemeListeners();
            }
            
            setupThemeListeners() {
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const theme = e.target.getAttribute('data-theme');
                        this.changeTheme(theme);
                    });
                });
            }
            
            changeTheme(theme) {
                this.currentTheme = theme;
                localStorage.setItem('chat-theme', theme);
                this.applyTheme(theme);
                
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.classList.remove('border-2', 'border-blue-500');
                    if (option.getAttribute('data-theme') === theme) {
                        option.classList.add('border-2', 'border-blue-500');
                    }
                });
            }
            
            applyTheme(theme) {
                document.body.className = document.body.className.replace(/theme-\w+/g, '');
                document.body.classList.add(theme);
            }
        }

        // Translation Manager
        class TranslationManager {
            constructor() {
                this.currentLang = localStorage.getItem('chat-language') || 'en';
                this.applyTranslation(this.currentLang);
                this.setupTranslationListeners();
            }
            
            setupTranslationListeners() {
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        const lang = option.getAttribute('data-lang');
                        this.changeLanguage(lang);
                        
                        // Close dropdown
                        const dropdown = option.closest('.dropdown-menu');
                        if (dropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                });
            }
            
            changeLanguage(lang) {
                this.currentLang = lang;
                localStorage.setItem('chat-language', lang);
                this.applyTranslation(lang);
                
                // Update active class
                document.querySelectorAll('.language-option').forEach(option => {
                    option.classList.remove('translation-active');
                    if (option.getAttribute('data-lang') === lang) {
                        option.classList.add('translation-active');
                    }
                });
            }
            
            applyTranslation(lang) {
                const langData = translations[lang] || translations['en'];
                
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    if (langData[key]) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = langData[key];
                        } else {
                            element.textContent = langData[key];
                        }
                    }
                });
                
                // Update UI elements that don't have data-translate
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn && currentUser) {
                    navLoginBtn.innerHTML = `<i class="fas fa-sign-out-alt mr-2"></i> ${langData['logout']}`;
                }
                
                if (window.chatManager) {
                    window.chatManager.updateChannelDescriptions(langData);
                }
            }
            
            getTranslation(key) {
                return translations[this.currentLang][key] || key;
            }
        }

        // Authentication Manager
        class AuthManager {
            constructor() {
                console.log("ğŸ” AuthManager initialized");
                this.initAuth();
            }

            initAuth() {
                onAuthStateChanged(auth, (user) => {
                    console.log("Auth state changed:", user ? `Logged in as ${user.email}` : "Logged out");
                    if (user) {
                        currentUser = user;
                        this.updateUIForLoggedInUser(user);
                        if (window.chatManager) {
                            window.chatManager.switchChannel(currentChannel);
                        }
                        // Hide login modal
                        const loginModal = document.getElementById('login-modal');
                        if (loginModal) {
                            loginModal.classList.add('hidden');
                        }
                    } else {
                        currentUser = null;
                        this.updateUIForLoggedOut();
                    }
                }, (error) => {
                    console.error("Auth error:", error);
                });
            }

            updateUIForLoggedInUser(user) {
                // Update user info in sidebar
                if (userNameElement) {
                    userNameElement.textContent = user.displayName || user.email.split('@')[0];
                }
                if (userEmailElement) {
                    userEmailElement.textContent = user.email;
                }
                if (statusDot) {
                    statusDot.classList.remove('bg-gray-500');
                    statusDot.classList.add('bg-green-500');
                }
                if (statusText) {
                    statusText.textContent = window.translationManager.getTranslation('online');
                }
                
                // Enable message input
                if (messageInput) {
                    messageInput.disabled = false;
                    messageInput.placeholder = window.translationManager.getTranslation('type_message');
                }
                if (sendButton) {
                    sendButton.disabled = false;
                }
                
                // Update navigation login button to logout
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.innerHTML = `<i class="fas fa-sign-out-alt mr-2"></i> ${window.translationManager.getTranslation('logout')}`;
                }
                
                // Hide the chat login button if it exists
                const chatLoginBtn = document.getElementById('chat-login-btn');
                if (chatLoginBtn) {
                    chatLoginBtn.style.display = 'none';
                }
            }

            updateUIForLoggedOut() {
                // Reset user info in sidebar
                if (userNameElement) {
                    userNameElement.textContent = 'Guest User';
                }
                if (userEmailElement) {
                    userEmailElement.textContent = window.translationManager.getTranslation('sign_in');
                }
                if (statusDot) {
                    statusDot.classList.remove('bg-green-500');
                    statusDot.classList.add('bg-gray-500');
                }
                if (statusText) {
                    statusText.textContent = window.translationManager.getTranslation('offline');
                }
                
                // Disable message input
                if (messageInput) {
                    messageInput.disabled = true;
                    messageInput.placeholder = window.translationManager.getTranslation('sign_in');
                }
                if (sendButton) {
                    sendButton.disabled = true;
                }
                
                // Update navigation login button to login
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.innerHTML = `<i class="fas fa-sign-in-alt mr-2"></i> ${window.translationManager.getTranslation('login')}`;
                }
                
                // Show the chat login button if it exists
                const chatLoginBtn = document.getElementById('chat-login-btn');
                if (chatLoginBtn) {
                    chatLoginBtn.style.display = 'inline-block';
                }
            }

            async loginWithGoogle() {
                try {
                    const provider = new GoogleAuthProvider();
                    const result = await signInWithPopup(auth, provider);
                    console.log("âœ… Google login successful");
                    return result.user;
                } catch (error) {
                    console.error("Google login error:", error);
                    throw error;
                }
            }

            async loginWithEmail(email, password) {
                try {
                    const result = await signInWithEmailAndPassword(auth, email, password);
                    console.log("âœ… Email login successful");
                    return result.user;
                } catch (error) {
                    console.error("Email login error:", error.code);
                    let errorMessage = "Login failed";
                    switch(error.code) {
                        case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                        case 'auth/user-not-found': errorMessage = "No account found with this email"; break;
                        case 'auth/wrong-password': errorMessage = "Wrong password"; break;
                        case 'auth/too-many-requests': errorMessage = "Too many attempts. Try again later"; break;
                        default: errorMessage = "Login failed: " + error.message;
                    }
                    throw new Error(errorMessage);
                }
            }

            async signupWithEmail(email, password, name) {
                try {
                    const result = await createUserWithEmailAndPassword(auth, email, password);
                    console.log("âœ… Account created successfully");
                    
                    if (name) {
                        await updateProfile(result.user, {
                            displayName: name
                        });
                    }
                    
                    try {
                        await addDoc(collection(db, "users"), {
                            uid: result.user.uid,
                            email: result.user.email,
                            displayName: name || result.user.email.split('@')[0],
                            createdAt: serverTimestamp()
                        });
                    } catch (firestoreError) {
                        console.warn("Note: User profile not saved to Firestore");
                    }
                    
                    return result.user;
                } catch (error) {
                    console.error("Signup error:", error.code);
                    let errorMessage = "Signup failed";
                    switch(error.code) {
                        case 'auth/email-already-in-use': errorMessage = "Email already in use"; break;
                        case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                        case 'auth/weak-password': errorMessage = "Password too weak (min 6 chars)"; break;
                        default: errorMessage = "Signup failed: " + error.message;
                    }
                    throw new Error(errorMessage);
                }
            }

            async resetPassword(email) {
                try {
                    await sendPasswordResetEmail(auth, email);
                    console.log("âœ… Password reset email sent");
                    return true;
                } catch (error) {
                    console.error("Reset password error:", error.code);
                    let errorMessage = "Failed to send reset email";
                    switch(error.code) {
                        case 'auth/invalid-email': errorMessage = "Invalid email"; break;
                        case 'auth/user-not-found': errorMessage = "No account found with this email"; break;
                        default: errorMessage = "Failed to send reset email: " + error.message;
                    }
                    throw new Error(errorMessage);
                }
            }

            async logout() {
                try {
                    await signOut(auth);
                    console.log("âœ… Logout successful");
                } catch (error) {
                    console.error("Logout error:", error);
                    alert("Logout failed: " + error.message);
                }
            }
        }

        // Chat Manager
        class ChatManager {
            constructor() {
                console.log("ğŸ’¬ ChatManager initialized");
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Send message
                if (sendButton) {
                    sendButton.addEventListener('click', () => this.sendMessage());
                }
                
                if (messageInput) {
                    messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                }

                // Channel switching
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.channel-item').forEach(i => {
                            i.classList.remove('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        });
                        item.classList.add('bg-white', 'shadow', 'border-l-4', 'border-pink-600');
                        const channelId = item.getAttribute('data-channel');
                        this.switchChannel(channelId);
                    });
                });

                // Search functionality
                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        if (!currentUser) {
                            alert("Please sign in to search messages");
                            return;
                        }
                        searchModal.classList.remove('hidden');
                        setTimeout(() => {
                            if (searchModalInput) searchModalInput.focus();
                        }, 100);
                    });
                }

                const searchModalClose = document.getElementById('search-modal-close');
                if (searchModalClose) {
                    searchModalClose.addEventListener('click', () => {
                        searchModal.classList.add('hidden');
                        if (searchModalInput) searchModalInput.value = '';
                        if (searchResults) {
                            searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                        }
                    });
                }

                if (searchModalInput) {
                    searchModalInput.addEventListener('input', () => this.searchMessages());
                }
            }

            async sendMessage() {
                if (!currentUser) {
                    alert("Please sign in to send messages");
                    return;
                }

                const messageText = messageInput.value.trim();
                if (!messageText) return;

                try {
                    const message = {
                        text: messageText,
                        senderId: currentUser.uid,
                        senderName: currentUser.displayName || currentUser.email.split('@')[0],
                        senderAvatar: currentUser.photoURL || '',
                        channel: currentChannel,
                        timestamp: serverTimestamp(),
                        readBy: []
                    };

                    console.log("ğŸ“¨ Sending message to Firestore...");
                    
                    await addDoc(collection(db, "messages"), message);
                    
                    messageInput.value = '';
                    messageInput.focus();
                    console.log("âœ… Message sent successfully!");
                    
                } catch (error) {
                    console.error("âŒ Error sending message:", error);
                    alert("Failed to send message. Check console for details.");
                }
            }
            
            async sendMediaMessage(media) {
                if (!currentUser) {
                    alert("Please sign in to send messages");
                    return;
                }

                try {
                    const message = {
                        type: media.type,
                        mediaUrl: media.url,
                        caption: media.caption,
                        senderId: currentUser.uid,
                        senderName: currentUser.displayName || currentUser.email.split('@')[0],
                        senderAvatar: currentUser.photoURL || '',
                        channel: currentChannel,
                        timestamp: serverTimestamp(),
                        readBy: []
                    };

                    console.log(`ğŸ“¨ Sending ${media.type} message to Firestore...`);
                    
                    await addDoc(collection(db, "messages"), message);
                    
                    console.log(`âœ… ${media.type} sent successfully!`);
                    
                } catch (error) {
                    console.error(`âŒ Error sending ${media.type}:`, error);
                    alert(`Failed to send ${media.type}. Check console for details.`);
                }
            }

            switchChannel(channelId) {
                console.log(`ğŸ”„ Switching to channel: #${channelId}`);
                currentChannel = channelId;
                
                if (channelTitle) channelTitle.textContent = `#${channelId}`;
                
                const channelDescriptions = {
                    ideas: window.translationManager.getTranslation('share_ideas'),
                    support: window.translationManager.getTranslation('get_answers'),
                    partnerships: window.translationManager.getTranslation('find_partners'),
                    growth: window.translationManager.getTranslation('discuss_strategies'),
                    resources: window.translationManager.getTranslation('discover_resources')
                };
                
                if (channelDescription && channelDescriptions[channelId]) {
                    channelDescription.textContent = channelDescriptions[channelId];
                }
                
                this.loadMessages(channelId);
            }
            
            updateChannelDescriptions(langData) {
                const channelDescriptions = {
                    ideas: langData['share_ideas'],
                    support: langData['get_answers'],
                    partnerships: langData['find_partners'],
                    growth: langData['discuss_strategies'],
                    resources: langData['discover_resources']
                };
                
                if (channelDescription && channelDescriptions[currentChannel]) {
                    channelDescription.textContent = channelDescriptions[currentChannel];
                }
            }

            loadMessages(channelId) {
                console.log(`ğŸ“¥ Loading messages for #${channelId}...`);
                
                if (messagesContainer) {
                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">Loading messages...</div>';
                }
                
                if (unsubscribeMessages) {
                    unsubscribeMessages();
                }
                
                // Only load messages if user is logged in
                if (!currentUser) {
                    if (messagesContainer) {
                        messagesContainer.innerHTML = `
                            <div class="text-center py-8">
                                <div class="text-pink-600 text-xl font-semibold mb-2">${window.translationManager.getTranslation('welcome')}</div>
                                <p class="text-gray-600 mb-4">Please sign in to view messages</p>
                                <button id="chat-login-btn" class="px-6 py-2 bg-pink-600 text-white rounded-full hover:bg-pink-700 transition-colors">
                                    Sign In to Continue
                                </button>
                            </div>
                        `;
                        
                        // Add event listener to the chat login button
                        const chatLoginBtn = document.getElementById('chat-login-btn');
                        if (chatLoginBtn) {
                            chatLoginBtn.addEventListener('click', () => {
                                const loginModal = document.getElementById('login-modal');
                                if (loginModal) {
                                    loginModal.classList.remove('hidden');
                                }
                            });
                        }
                    }
                    return;
                }
                
                try {
                    const messagesQuery = query(
                        collection(db, "messages"),
                        where("channel", "==", channelId),
                        orderBy("timestamp", "asc")
                    );
                    
                    unsubscribeMessages = onSnapshot(messagesQuery, 
                        (snapshot) => {
                            console.log(`ğŸ“Š Received ${snapshot.size} messages`);
                            
                            if (messagesContainer) {
                                messagesContainer.innerHTML = '';
                                
                                if (snapshot.empty) {
                                    messagesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">No messages yet. Be the first to say hi! ğŸ‘‹</div>';
                                    return;
                                }
                                
                                snapshot.forEach((doc) => {
                                    const message = doc.data();
                                    this.displayMessage(message);
                                });
                                
                                setTimeout(() => {
                                    if (messagesContainer) {
                                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                                    }
                                }, 100);
                            }
                        }, 
                        (error) => {
                            console.error("âŒ Error loading messages:", error);
                            
                            if (error.code === 'failed-precondition') {
                                console.error("âš ï¸ Firestore index required!");
                                
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = `
                                        <div class="text-red-500 text-center py-4">
                                            <p class="font-bold">Firestore Index Required</p>
                                            <p class="text-sm mt-2">Check browser console for details.</p>
                                        </div>`;
                                }
                            } else {
                                if (messagesContainer) {
                                    messagesContainer.innerHTML = '<div class="text-red-500 text-center py-4">Failed to load messages</div>';
                                }
                            }
                        }
                    );
                } catch (error) {
                    console.error("âŒ Error setting up listener:", error);
                    if (messagesContainer) {
                        messagesContainer.innerHTML = '<div class="text-red-500 text-center py-4">Error setting up chat</div>';
                    }
                }
            }

            displayMessage(message) {
                if (!messagesContainer) return;
                
                const messageDiv = document.createElement('div');
                const isCurrentUser = currentUser && message.senderId === currentUser.uid;
                
                messageDiv.className = `message flex max-w-[80%] mb-4 ${isCurrentUser ? 'self-end flex-row-reverse' : 'self-start'}`;
                
                let timeString = 'Just now';
                if (message.timestamp && message.timestamp.toDate) {
                    try {
                        const date = message.timestamp.toDate();
                        timeString = this.formatTime(date);
                    } catch (error) {
                        console.error("Error formatting time:", error);
                    }
                }
                
                const avatarImg = message.senderAvatar || '';
                const displayName = message.senderName || 'Anonymous';
                
                let messageContent = '';
                
                if (message.type === 'photo') {
                    messageContent = `
                        <div class="mb-2">
                            <img src="${message.mediaUrl}" alt="Photo" class="max-w-xs max-h-64 rounded-lg shadow-md">
                        </div>
                        <div class="message-text text-sm">${message.caption || ''}</div>
                    `;
                } else if (message.type === 'video') {
                    messageContent = `
                        <div class="mb-2">
                            <video src="${message.mediaUrl}" controls class="max-w-xs max-h-64 rounded-lg shadow-md"></video>
                        </div>
                        <div class="message-text text-sm">${message.caption || ''}</div>
                    `;
                } else if (message.type === 'audio') {
                    messageContent = `
                        <div class="mb-2">
                            <audio src="${message.mediaUrl}" controls class="w-full"></audio>
                        </div>
                        <div class="message-text text-sm">${message.caption || ''}</div>
                    `;
                } else {
                    messageContent = `<div class="message-text text-sm">${message.text.replace(/\n/g, '<br>')}</div>`;
                }
                
                messageDiv.innerHTML = `
                    <div class="message-avatar w-10 h-10 rounded-full flex items-center justify-center text-white mx-2 flex-shrink-0 overflow-hidden ${isCurrentUser ? 'bg-yellow-600' : 'bg-pink-300'}">
                        ${avatarImg ? 
                            `<img src="${avatarImg}" alt="${displayName}" class="w-full h-full object-cover" onerror="handleImageError(this)">` :
                            `<span class="text-lg font-semibold">${displayName.charAt(0).toUpperCase()}</span>`
                        }
                    </div>
                    <div class="message-content px-4 py-3 rounded-2xl shadow-sm ${isCurrentUser ? 'bg-pink-300 text-white rounded-tr-none' : 'bg-pink-100 rounded-tl-none'}">
                        <div class="message-sender font-semibold text-sm mb-1 ${isCurrentUser ? 'text-gray-100' : 'text-pink-600'}">${displayName}</div>
                        ${messageContent}
                        <div class="message-time text-xs opacity-70 mt-1 text-right">${timeString}</div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            }

            async searchMessages() {
                const searchTerm = searchModalInput.value.trim().toLowerCase();
                
                if (!searchTerm) {
                    if (searchResults) {
                        searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                    }
                    return;
                }
                
                try {
                    const messagesQuery = query(
                        collection(db, "messages"),
                        orderBy("timestamp", "desc")
                    );
                    
                    const snapshot = await getDocs(messagesQuery);
                    if (searchResults) {
                        searchResults.innerHTML = '';
                    }
                    
                    let foundMessages = [];
                    
                    snapshot.forEach((doc) => {
                        const message = doc.data();
                        if (message.text && message.text.toLowerCase().includes(searchTerm) || 
                            message.senderName && message.senderName.toLowerCase().includes(searchTerm)) {
                            foundMessages.push({...message, id: doc.id});
                        }
                    });
                    
                    if (foundMessages.length === 0) {
                        if (searchResults) {
                            searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">No messages found</div>';
                        }
                        return;
                    }
                    
                    foundMessages.forEach((message) => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'search-result-item px-3 py-2 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors';
                        resultItem.innerHTML = `
                            <div class="search-result-sender font-bold text-pink-600">${message.senderName || 'Anonymous'}</div>
                            <div class="search-result-text text-sm mt-1">${message.text || ''}</div>
                            <div class="message-time text-xs text-gray-500 mt-1">${this.formatTime(message.timestamp?.toDate())} â€¢ #${message.channel || 'unknown'}</div>
                        `;
                        
                        resultItem.addEventListener('click', () => {
                            if (message.channel) {
                                this.switchChannel(message.channel);
                            }
                            searchModal.classList.add('hidden');
                            if (searchModalInput) searchModalInput.value = '';
                            if (searchResults) searchResults.innerHTML = '<div class="text-gray-500 text-center py-4">Enter a search term</div>';
                        });
                        
                        if (searchResults) {
                            searchResults.appendChild(resultItem);
                        }
                    });
                } catch (error) {
                    console.error("Search error:", error);
                    if (searchResults) {
                        searchResults.innerHTML = '<div class="text-red-500 text-center py-4">Search failed</div>';
                    }
                }
            }

            formatTime(date) {
                if (!date) return 'Just now';
                
                try {
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins < 1) return 'Just now';
                    if (diffMins < 60) return `${diffMins}m ago`;
                    if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;
                    
                    return date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return 'Just now';
                }
            }
        }

        // Settings Manager
        class SettingsManager {
            constructor() {
                this.setupSettingsListeners();
            }
            
            setupSettingsListeners() {
                const settingsBtn = document.getElementById('settings-btn');
                const settingsClose = document.getElementById('settings-close');
                const signoutBtn = document.getElementById('signout-btn');
                
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', () => {
                        const settingsModal = document.getElementById('settings-modal');
                        if (settingsModal) {
                            settingsModal.classList.remove('hidden');
                        }
                    });
                }
                
                if (settingsClose) {
                    settingsClose.addEventListener('click', () => {
                        const settingsModal = document.getElementById('settings-modal');
                        if (settingsModal) {
                            settingsModal.classList.add('hidden');
                        }
                    });
                }
                
                if (signoutBtn) {
                    signoutBtn.addEventListener('click', () => {
                        if (window.authManager) {
                            window.authManager.logout();
                            const settingsModal = document.getElementById('settings-modal');
                            if (settingsModal) {
                                settingsModal.classList.add('hidden');
                            }
                        }
                    });
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log("ğŸš€ DOM loaded, initializing Girls Chat...");
            
            // Initialize managers
            window.translationManager = new TranslationManager();
            window.themeManager = new ThemeManager();
            window.authModalManager = new AuthModalManager();
            window.authManager = new AuthManager();
            window.chatManager = new ChatManager();
            window.mediaManager = new MediaManager();
            window.settingsManager = new SettingsManager();

            // Setup navigation toggle for mobile
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            const navOverlay = document.querySelector('.nav-overlay');
            
            if (hamburger && navLinks && navOverlay) {
                hamburger.addEventListener('click', () => {
                    hamburger.classList.toggle('active');
                    navLinks.style.left = navLinks.style.left === '0px' ? '-100%' : '0px';
                    navOverlay.classList.toggle('hidden');
                });
                
                navOverlay.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    navLinks.style.left = '-100%';
                    navOverlay.classList.add('hidden');
                });
            }
            
            // Setup dropdowns
            const dropdowns = document.querySelectorAll('.dropdown');
            dropdowns.forEach(dropdown => {
                const link = dropdown.querySelector('.nav-link');
                const menu = dropdown.querySelector('.dropdown-menu');
                
                if (link && menu) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        menu.classList.toggle('hidden');
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (!dropdown.contains(e.target)) {
                            menu.classList.add('hidden');
                        }
                    });
                }
            });

            // Setup navigation login button (navbar)
            const navLoginBtn = document.getElementById('nav-login-btn');
            if (navLoginBtn) {
                navLoginBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (currentUser) {
                        window.authManager.logout();
                    } else {
                        const loginModal = document.getElementById('login-modal');
                        if (loginModal) {
                            loginModal.classList.remove('hidden');
                        }
                    }
                });
            }

            // Setup navigation search button
            const navSearchBtn = document.getElementById('nav-search-btn');
            if (navSearchBtn) {
                navSearchBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Show the search modal
                    const searchModal = document.getElementById('search-modal');
                    if (searchModal) {
                        searchModal.classList.remove('hidden');
                        searchModal.scrollIntoView({ behavior: 'smooth' });
                        setTimeout(() => {
                            const searchInput = document.getElementById('search-modal-input');
                            if (searchInput) searchInput.focus();
                        }, 300);
                    }
                });
            }

            // Set initial active channel
            const initialChannel = document.querySelector('.channel-item[data-channel="ideas"]');
            if (initialChannel) {
                initialChannel.click();
            }
            
            // Setup chat login button (in the chat area)
            const chatLoginBtn = document.getElementById('chat-login-btn');
            if (chatLoginBtn) {
                chatLoginBtn.addEventListener('click', () => {
                    const loginModal = document.getElementById('login-modal');
                    if (loginModal) {
                        loginModal.classList.remove('hidden');
                    }
                });
            }
            
            console.log("âœ… Girls Chat initialization complete!");
        });

        // Make functions available globally
        window.handleImageError = handleImageError;
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Check localStorage for user
    const userData = localStorage.getItem('girlspaceUser');
    
    if (userData) {
        // User is logged in
        const loginButtons = document.querySelectorAll('a[href="./login.html"]');
        loginButtons.forEach(btn => {
            btn.innerHTML = '<i class="fas fa-user-circle mr-2"></i> My Profile';
            btn.href = './profile.html';
            btn.classList.remove('border-2', 'border-primary', 'text-primary');
            btn.classList.add('bg-primary', 'text-white', 'px-4', 'py-2', 'rounded-full');
        });
        
        // Add logout button if not exists
        // if (!document.getElementById('logoutBtn')) {
        //     const logoutBtn = document.createElement('button');
        //     logoutBtn.id = 'logoutBtn';
        //     logoutBtn.className = 'ml-2 px-3 py-1 bg-red-500 text-white rounded text-sm';
        //     logoutBtn.textContent = 'Logout';
        //     logoutBtn.onclick = () => {
        //         localStorage.removeItem('girlspaceUser');
        //         window.location.reload();
        //     };
            
        //     const nav = document.querySelector('.hidden.lg\\:flex.items-center.gap-6');
        //     if (nav) nav.appendChild(logoutBtn);
        // }
    }
});
</script>
</body>
</html>