<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Let's Chat | Connect with fellow entrepreneurs</title>
 <!-- Tailwind CSS -->
 <script src="https://cdn.tailwindcss.com"></script>
 <!-- Firebase SDKs -->
 <script type="module">
 import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
 import {
 getAuth,
 createUserWithEmailAndPassword,
 signInWithEmailAndPassword,
 signOut,
 onAuthStateChanged
 } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
 import {
 getFirestore,
 collection,
 addDoc,
 query,
 orderBy,
 onSnapshot,
 serverTimestamp,
 limit
 } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

 // Your Firebase configuration
 const firebaseConfig = {
 apiKey: "AIzaSyD5K27SYd3NzV5FOtMtPZs_l8UhEUq42zc",
 authDomain: "sigin-b3aa1.firebaseapp.com",
 projectId: "sigin-b3aa1",
 storageBucket: "sigin-b3aa1.firebasestorage.app",
 messagingSenderId: "390069352394",
 appId: "1:390069352394:web:aa32d4a640b6f7fee54133",
 measurementId: "G-WF0H2KJN02"
 };

 // Initialize Firebase
 const app = initializeApp(firebaseConfig);
 const auth = getAuth(app);
 const db = getFirestore(app);

 // Make Firebase available globally
 window.firebase = {
 auth,
 db,
 collection,
 addDoc,
 query,
 orderBy,
 onSnapshot,
 serverTimestamp,
 limit,
 createUserWithEmailAndPassword,
 signInWithEmailAndPassword,
 signOut,
 onAuthStateChanged
 };
 </script>
</head>

<body class="bg-gray-50 font-sans">
 <div class="flex h-screen">
 <!-- Left Sidebar -->
 <div class="w-64 bg-gradient-to-b from-[#ef71f3] to-[#380712] text-white flex flex-col">
 <!-- Logo and Title -->
 <div class="p-6 border-b border-gray-800">
 <h1 class="text-xl font-bold">Let's Chat</h1>
 <p class="text-gray-400 text-sm mt-1">Connect with fellow entrepreneurs</p>
 </div>

 <!-- User Status -->
 <div class="p-6 border-b border-gray-800">
 <div class="flex items-center space-x-3">
 <div class="relative">
 <div class="w-9 h-9 rounded-full bg-gray-700 flex items-center justify-center text-white font-semibold text-sm">G</div>
 <div class="w-2 h-2 bg-black rounded-full absolute bottom-0 right-0 border-2 border-white"></div>
 </div>
 <div>
 <p class="font-medium">Guest User</p>
 <p class="text-gray-400 text-sm">Join to chat</p>
 <p class="text-gray-500 text-xs">Offline</p>
 </div>
 </div>
 </div>

 <!-- Channels List -->
 <div class="p-6 flex-grow">
 <h3 class="text-gray-400 text-xs font-semibold uppercase tracking-wider mb-4">Channels</h3>
 <div class="space-y-2">
 <div class="p-2 bg-[rgba(241,99,229,0.1)] border-l-3 border-[#e95151] rounded-l hover:bg-[rgba(58,3,75,0.05)] transition-all duration-200">
 <div class="flex items-center">
 <span class="text-gray-400 mr-2">#</span>
 <span>People</span>
 </div>
 </div>
 </div>

 <h3 class="text-gray-400 text-xs font-semibold uppercase tracking-wider mt-6 mb-4">Discussion Channels
 </h3>
 <div class="space-y-3">
 <div class="p-3 hover:bg-[rgba(58,3,75,0.05)] rounded-lg transition-all duration-200">
 <div class="flex items-center justify-between">
 <div class="flex items-center">
 <span class="text-gray-400 mr-2">#</span>
 <span>Ideas & Brainstorming</span>
 </div>
 <span class="text-gray-500 text-xs">Loading...</span>
 </div>
 </div>
 <div class="p-3 hover:bg-[rgba(58,3,75,0.05)] rounded-lg transition-all duration-200">
 <div class="flex items-center justify-between">
 <div class="flex items-center">
 <span class="text-gray-400 mr-2">#</span>
 <span>Q&A Support</span>
 </div>
 <span class="text-gray-500 text-xs">Loading...</span>
 </div>
 </div>
 <div class="p-3 hover:bg-[rgba(58,3,75,0.05)] rounded-lg transition-all duration-200">
 <div class="flex items-center justify-between">
 <div class="flex items-center">
 <span class="text-gray-400 mr-2">#</span>
 <span>Partnerships</span>
 </div>
 <span class="text-gray-500 text-xs">Loading...</span>
 </div>
 </div>
 </div>
 </div>

 <!-- Auth Status -->
 <div id="authStatusSidebar" class="p-6 border-t border-gray-800 hidden">
 <div class="text-center">
 <p class="text-sm text-gray-300"></p>
 </div>
 </div>
 </div>

 <!-- Main Chat Area -->
 <div class="flex-1 flex flex-col">
 <!-- Chat Header -->
 <div class="bg-white border-b border-gray-200 p-4">
 <div class="flex items-center justify-between">
 <div class="flex items-center space-x-4">
 <div class="flex items-center">
 <span class="text-2xl mr-2">ðŸ’¬</span>
 <h2 class="text-lg font-semibold">Ideas & Brainstorming</h2>
 </div>
 <span class="text-gray-500 text-sm">Share and discuss business ideas</span>
 </div>
 <div id="userInfo" class="hidden">
 <div class="flex items-center space-x-3">
 <div class="relative">
 <div class="w-9 h-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-sm font-semibold" id="userInitial">U</div>
 <div class="w-2 h-2 bg-green-500 rounded-full absolute bottom-0 right-0 border-2 border-[rgb(94,230,101)]" id="userStatusIndicator"></div>
 </div>
 <div>
 <p class="font-medium text-sm" id="userEmail">user@example.com</p>
 <button id="signOutBtn" class="text-xs text-red-500 hover:text-red-700">Sign
 Out</button>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- Messages Container -->
 <div id="messagesContainer" class="flex-grow p-6 overflow-y-auto bg-gray-50 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
 <div id="noMessages" class="text-center py-12">
 <div class="max-w-md mx-auto">
 <div class="text-5xl mb-4">ðŸ’¡</div>
 <h3 class="text-xl font-semibold text-gray-700 mb-2">Welcome to Ideas & Brainstorming!</h3>
 <p class="text-gray-500 mb-6">Share your business ideas, get feedback, and collaborate with
 fellow entrepreneurs.</p>
 <div id="authPrompt" class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
 <p class="text-gray-700 mb-4">Sign in to join the conversation!</p>
 <div class="space-y-4">
 <input type="email" id="loginEmail" placeholder="Email address"
 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
 <input type="password" id="loginPassword" placeholder="Password"
 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
 <div class="flex space-x-3">
 <button id="signInBtn"
 class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
 Sign In
 </button>
 <button id="showRegisterBtn"
 class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition duration-200">
 Register
 </button>
 </div>
 <p class="text-xs text-gray-500 text-center">By signing in, you agree to our community
 guidelines</p>
 </div>
 </div>

 <!-- Register Form (Hidden) -->
 <div id="registerForm"
 class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm mt-4 hidden">
 <p class="text-gray-700 mb-4">Create your account</p>
 <div class="space-y-4">
 <input type="email" id="registerEmail" placeholder="Email address"
 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
 <input type="password" id="registerPassword" placeholder="Password (min. 6 characters)"
 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
 <input type="password" id="confirmPassword" placeholder="Confirm password"
 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
 <div class="flex space-x-3">
 <button id="registerBtn"
 class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
 Create Account
 </button>
 <button id="showLoginBtn"
 class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition duration-200">
 Back to Login
 </button>
 </div>
 </div>
 </div>

 <!-- Status Messages -->
 <div id="authStatus" class="mt-4 p-4 rounded-lg hidden"></div>
 </div>
 </div>
 <!-- Messages will be inserted here -->
 </div>

 <!-- Message Input -->
 <div class="bg-white border-t border-gray-200 p-4">
 <div id="messageInputContainer" class="max-w-3xl mx-auto">
 <div class="flex items-center space-x-3">
 <div class="flex-grow relative">
 <input type="text" id="messageInput"
 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent pr-24"
 placeholder="Sign in to send messages..." disabled>
 <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
 <span class="text-gray-400 text-sm">Press Enter to send</span>
 </div>
 </div>
 <button id="sendMessageBtn"
 class="bg-pink-600 hover:bg-pink-400 text-white font-medium py-3 px-6 rounded-lg transition duration-200 flex items-center"
 disabled>
 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
 fill="currentColor">
 <path fill-rule="evenodd"
 d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
 clip-rule="evenodd" />
 </svg>
 Send
 </button>
 </div>
 </div>
 </div>
 </div>
 </div>

 <!-- JavaScript for the chat application -->
 <script>
 // DOM Elements
 const messagesContainer = document.getElementById('messagesContainer');
 const noMessages = document.getElementById('noMessages');
 const authPrompt = document.getElementById('authPrompt');
 const messageInput = document.getElementById('messageInput');
 const sendMessageBtn = document.getElementById('sendMessageBtn');
 const messageInputContainer = document.getElementById('messageInputContainer');
 const userInfo = document.getElementById('userInfo');
 const userEmail = document.getElementById('userEmail');
 const userInitial = document.getElementById('userInitial');
 const userStatusIndicator = document.getElementById('userStatusIndicator');
 const signOutBtn = document.getElementById('signOutBtn');
 const authStatusSidebar = document.getElementById('authStatusSidebar');

 // Auth form elements
 const loginEmail = document.getElementById('loginEmail');
 const loginPassword = document.getElementById('loginPassword');
 const registerEmail = document.getElementById('registerEmail');
 const registerPassword = document.getElementById('registerPassword');
 const confirmPassword = document.getElementById('confirmPassword');
 const signInBtn = document.getElementById('signInBtn');
 const registerBtn = document.getElementById('registerBtn');
 const showRegisterBtn = document.getElementById('showRegisterBtn');
 const showLoginBtn = document.getElementById('showLoginBtn');
 const registerForm = document.getElementById('registerForm');
 const authStatus = document.getElementById('authStatus');

 // Firestore references
 let messagesCollection;
 let unsubscribeMessages;
 let currentUser = null;

 // Initialize the app when Firebase is loaded
 document.addEventListener('DOMContentLoaded', () => {
 // Check if Firebase is loaded
 if (!window.firebase) {
 showAuthStatus('Firebase initialization failed. Please check your configuration.', 'error');
 return;
 }

 // Set up Firebase auth state observer
 window.firebase.onAuthStateChanged(window.firebase.auth, (user) => {
 if (user) {
 // User is signed in
 currentUser = user;
 showChatInterface(user);
 loadMessages();
 } else {
 // User is signed out
 showAuthInterface();
 }
 });

 // Set up event listeners
 setupEventListeners();
 });

 function setupEventListeners() {
 // Auth form toggling
 showRegisterBtn.addEventListener('click', (e) => {
 e.preventDefault();
 authPrompt.classList.add('hidden');
 registerForm.classList.remove('hidden');
 clearAuthStatus();
 });

 showLoginBtn.addEventListener('click', (e) => {
 e.preventDefault();
 registerForm.classList.add('hidden');
 authPrompt.classList.remove('hidden');
 clearAuthStatus();
 });

 // Sign in
 signInBtn.addEventListener('click', signIn);
 loginEmail.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') signIn();
 });
 loginPassword.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') signIn();
 });

 // Register
 registerBtn.addEventListener('click', register);
 registerEmail.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') register();
 });
 registerPassword.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') register();
 });
 confirmPassword.addEventListener('keypress', (e) => {
 if (e.key === 'Enter') register();
 });

 // Sign out
 signOutBtn.addEventListener('click', signOutUser);

 // Chat functionality
 sendMessageBtn.addEventListener('click', sendMessage);
 messageInput.addEventListener('keypress', (e) => {
 if (e.key === 'Enter' && !e.shiftKey) {
 e.preventDefault();
 sendMessage();
 }
 });
 }

 function signIn() {
 const email = loginEmail.value;
 const password = loginPassword.value;

 if (!email || !password) {
 showAuthStatus('Please enter both email and password.', 'error');
 return;
 }

 showAuthStatus('Signing in...', 'loading');

 window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password)
 .then((userCredential) => {
 // Signed in successfully
 clearAuthForm();
 showAuthStatus('Welcome back!', 'success');
 })
 .catch((error) => {
 const errorMessage = getFirebaseErrorMessage(error.code);
 showAuthStatus(errorMessage, 'error');
 });
 }

 function register() {
 const email = registerEmail.value;
 const password = registerPassword.value;
 const confirm = confirmPassword.value;

 if (!email || !password || !confirm) {
 showAuthStatus('Please fill in all fields.', 'error');
 return;
 }

 if (password.length < 6) {
 showAuthStatus('Password must be at least 6 characters long.', 'error');
 return;
 }

 if (password !== confirm) {
 showAuthStatus('Passwords do not match.', 'error');
 return;
 }

 showAuthStatus('Creating your account...', 'loading');

 window.firebase.createUserWithEmailAndPassword(window.firebase.auth, email, password)
 .then((userCredential) => {
 // Account created successfully
 clearAuthForm();
 showAuthStatus('Account created successfully!', 'success');
 })
 .catch((error) => {
 const errorMessage = getFirebaseErrorMessage(error.code);
 showAuthStatus(errorMessage, 'error');
 });
 }

 function signOutUser() {
 // Unsubscribe from Firestore updates
 if (unsubscribeMessages) {
 unsubscribeMessages();
 }

 window.firebase.signOut(window.firebase.auth)
 .then(() => {
 // Sign-out successful
 showAuthStatus('You have been signed out.', 'info');
 })
 .catch((error) => {
 showAuthStatus('Error signing out. Please try again.', 'error');
 });
 }

 function showAuthInterface() {
 // Show auth interface
 noMessages.classList.remove('hidden');
 authPrompt.classList.remove('hidden');
 registerForm.classList.add('hidden');
 userInfo.classList.add('hidden');

 // Disable message input
 messageInput.disabled = true;
 messageInput.placeholder = "Sign in to send messages...";
 sendMessageBtn.disabled = true;

 // Clear messages
 const existingMessages = messagesContainer.querySelectorAll('.message');
 existingMessages.forEach(msg => msg.remove());

 // Show sidebar status
 authStatusSidebar.classList.remove('hidden');
 const statusText = authStatusSidebar.querySelector('p');
 statusText.textContent = "Sign in to join the conversation";
 statusText.className = "text-sm text-gray-300";
 }

 function showChatInterface(user) {
 // Hide auth interface
 noMessages.classList.add('hidden');
 authPrompt.classList.add('hidden');
 registerForm.classList.add('hidden');
 userInfo.classList.remove('hidden');

 // Update user info
 const email = user.email;
 const initial = email.charAt(0).toUpperCase();

 userEmail.textContent = email;
 userInitial.textContent = initial;
 userInitial.className = "w-9 h-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-sm font-semibold";
 userStatusIndicator.className = "w-2 h-2 bg-green-500 rounded-full absolute bottom-0 right-0 border-2 border-[rgb(94,230,101)]";

 // Enable message input
 messageInput.disabled = false;
 messageInput.placeholder = "Message #ideas-and-brainstorming";
 sendMessageBtn.disabled = false;
 messageInput.focus();

 // Update sidebar status
 authStatusSidebar.classList.remove('hidden');
 const statusText = authStatusSidebar.querySelector('p');
 statusText.textContent = `Connected as ${email}`;
 statusText.className = "text-sm text-green-400";

 // Set up Firestore collection reference
 messagesCollection = window.firebase.collection(window.firebase.db, 'messages');
 }

 function loadMessages() {
 // Clear existing messages
 const existingMessages = messagesContainer.querySelectorAll('.message');
 existingMessages.forEach(msg => msg.remove());

 // Create a query to get messages ordered by timestamp
 const messagesQuery = window.firebase.query(
 messagesCollection,
 window.firebase.orderBy('timestamp', 'asc'),
 window.firebase.limit(100)
 );

 // Listen for real-time updates
 unsubscribeMessages = window.firebase.onSnapshot(messagesQuery, (snapshot) => {
 // Clear existing messages
 const existingMessages = messagesContainer.querySelectorAll('.message');
 existingMessages.forEach(msg => msg.remove());

 // Process messages
 snapshot.forEach((doc) => {
 const message = doc.data();
 message.id = doc.id;
 displayMessage(message);
 });

 // Scroll to the latest message
 setTimeout(() => {
 messagesContainer.scrollTop = messagesContainer.scrollHeight;
 }, 100);
 }, (error) => {
 console.error('Error loading messages:', error);
 showChatStatus('Error loading messages. Please refresh the page.', 'error');
 });
 }

 function displayMessage(message) {
 const messageDiv = document.createElement('div');
 messageDiv.className = 'message animate-fadeIn mb-4';

 // Check if this message is from the current user
 const isCurrentUser = currentUser && message.userId === currentUser.uid;

 // Format the timestamp
 let timestamp = 'Just now';
 if (message.timestamp) {
 const date = message.timestamp.toDate ? message.timestamp.toDate() : new Date(message.timestamp);
 timestamp = date.toLocaleTimeString([], {
 hour: '2-digit',
 minute: '2-digit'
 });
 }

 // Create message HTML
 messageDiv.innerHTML = `
 <div class="flex ${isCurrentUser ? 'justify-end' : 'justify-start'}">
 ${!isCurrentUser ? `
 <div class="flex-shrink-0 mr-3">
 <div class="relative">
 <div class="w-9 h-9 rounded-full bg-gray-600 text-white flex items-center justify-center text-sm font-semibold">
 ${message.userInitial || 'U'}
 </div>
 <div class="w-2 h-2 bg-green-500 rounded-full absolute bottom-0 right-0 border-2 border-[rgb(94,230,101)]"></div>
 </div>
 </div>
 ` : ''}
 
 <div class="flex flex-col ${isCurrentUser ? 'items-end' : 'items-start'}">
 <div class="flex items-center mb-1">
 ${!isCurrentUser ? `
 <span class="font-medium text-sm text-gray-700 mr-2">${message.userEmail || 'User'}</span>
 ` : ''}
 <span class="text-xs text-gray-500">${timestamp}</span>
 </div>
 
 <div class="max-w-[80%] rounded-[18px] px-4 py-3 ${isCurrentUser ? 'bg-[#db38fc] text-white ml-auto rounded-br-[4px]' : 'bg-[#d7c1eb] text-[#281e29] mr-auto rounded-bl-[4px]'}">
 ${escapeHtml(message.text)}
 </div>
 </div>
 
 ${isCurrentUser ? `
 <div class="flex-shrink-0 ml-3">
 <div class="relative">
 <div class="w-9 h-9 rounded-full bg-indigo-500 text-white flex items-center justify-center text-sm font-semibold">
 ${message.userInitial || 'U'}
 </div>
 <div class="w-2 h-2 bg-green-500 rounded-full absolute bottom-0 right-0 border-2 border-[rgb(94,230,101)]"></div>
 </div>
 </div>
 ` : ''}
 </div>
 `;

 messagesContainer.appendChild(messageDiv);
 }

 function sendMessage() {
 const text = messageInput.value.trim();

 if (!text || !currentUser) return;

 // Show sending indicator
 const originalText = sendMessageBtn.innerHTML;
 sendMessageBtn.innerHTML = `
 <svg class="animate-spin h-5 w-5 mr-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
 <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
 <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
 </svg>
 Sending...
 `;
 sendMessageBtn.disabled = true;

 // Create message object
 const message = {
 text: text,
 userId: currentUser.uid,
 userEmail: currentUser.email,
 userInitial: currentUser.email.charAt(0).toUpperCase(),
 timestamp: window.firebase.serverTimestamp()
 };

 // Add message to Firestore
 window.firebase.addDoc(messagesCollection, message)
 .then((docRef) => {
 // Clear input field
 messageInput.value = '';
 messageInput.focus();

 // Restore send button
 sendMessageBtn.innerHTML = originalText;
 sendMessageBtn.disabled = false;
 })
 .catch((error) => {
 console.error('Error sending message:', error);
 showChatStatus('Failed to send message. Please try again.', 'error');

 // Restore send button
 sendMessageBtn.innerHTML = originalText;
 sendMessageBtn.disabled = false;
 });
 }

 function showAuthStatus(message, type) {
 authStatus.textContent = message;
 authStatus.classList.remove('hidden');

 // Set color based on type
 authStatus.className = 'mt-4 p-4 rounded-lg';
 if (type === 'success') {
 authStatus.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-200');
 } else if (type === 'error') {
 authStatus.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-200');
 } else if (type === 'loading') {
 authStatus.classList.add('bg-blue-100', 'text-blue-800', 'border', 'border-blue-200');
 } else {
 authStatus.classList.add('bg-gray-100', 'text-gray-800', 'border', 'border-gray-200');
 }

 // Auto-hide success messages after 3 seconds
 if (type === 'success') {
 setTimeout(() => {
 authStatus.classList.add('hidden');
 }, 3000);
 }
 }

 function showChatStatus(message, type) {
 // Create a temporary status message
 const statusDiv = document.createElement('div');
 statusDiv.className = 'text-center py-2 animate-fadeIn';

 if (type === 'error') {
 statusDiv.classList.add('text-red-600', 'bg-red-50', 'rounded-lg');
 } else {
 statusDiv.classList.add('text-blue-600', 'bg-blue-50', 'rounded-lg');
 }

 statusDiv.textContent = message;
 messagesContainer.appendChild(statusDiv);

 // Auto-hide after 3 seconds
 setTimeout(() => {
 statusDiv.remove();
 }, 3000);
 }

 function clearAuthStatus() {
 authStatus.classList.add('hidden');
 }

 function clearAuthForm() {
 loginEmail.value = '';
 loginPassword.value = '';
 registerEmail.value = '';
 registerPassword.value = '';
 confirmPassword.value = '';
 }

 function getFirebaseErrorMessage(errorCode) {
 switch (errorCode) {
 case 'auth/invalid-email':
 return 'Invalid email address.';
 case 'auth/user-disabled':
 return 'This account has been disabled.';
 case 'auth/user-not-found':
 return 'No account found with this email.';
 case 'auth/wrong-password':
 return 'Incorrect password.';
 case 'auth/email-already-in-use':
 return 'This email is already registered.';
 case 'auth/weak-password':
 return 'Password is too weak.';
 case 'auth/operation-not-allowed':
 return 'Email/password accounts are not enabled.';
 case 'auth/too-many-requests':
 return 'Too many failed attempts. Please try again later.';
 default:
 return 'An error occurred. Please try again.';
 }
 }

<<<<<<< HEAD
 function escapeHtml(text) {
 const div = document.createElement('div');
 div.textContent = text;
 return div.innerHTML;
 }
 </script>

 <!-- Custom animations for Tailwind -->
 <style>
 @keyframes fadeIn {
 from {
 opacity: 0;
 transform: translateY(10px);
 }
 to {
 opacity: 1;
 transform: translateY(0);
 }
 }
 .animate-fadeIn {
 animation: fadeIn 0.3s ease-in;
 }
 </style>
=======
        // Function to change language
        function changeLanguage(lang) {
            currentLang = lang;
            
            // Update all elements with data-translate attribute
            const translatableElements = document.querySelectorAll('[data-translate]');
            translatableElements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                    
                    // Update placeholder for search input
                    if (element.tagName === 'INPUT' && element.getAttribute('placeholder')) {
                        element.setAttribute('placeholder', translations[lang][key]);
                    }
                }
            });
            
            // Update the language dropdown text
            const languageLink = document.querySelector('#language-dropdown > a');
            if (languageLink && translations[lang] && translations[lang]['languages']) {
                languageLink.textContent = translations[lang]['languages'];
            }
        }
    </script>
     <!-- Import Firebase and Chat Service -->
    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { chatService } from './firebase-chat-service.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let currentUser = null;
        let currentRoomId = null;
        let selectedMessageId = null;

        // DOM Elements
        const roomsContainer = document.getElementById('roomsContainer');
        const chatContainer = document.getElementById('chatContainer');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessage');
        const membersList = document.getElementById('membersList');
        const membersCount = document.getElementById('membersCount');
        const roomName = document.getElementById('roomName');
        const mobileRoomName = document.getElementById('mobileRoomName');
        const roomDescription = document.getElementById('roomDescription');
        const typingIndicator = document.getElementById('typingIndicator');
        const charCount = document.getElementById('charCount');

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            await loadChatRooms();
            setupEventListeners();
        });

        // Check authentication
        async function checkAuth() {
            return new Promise((resolve) => {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUser = user;
                        console.log('User authenticated:', user.uid);
                        resolve(user);
                    } else {
                        // Redirect to login if not authenticated
                        window.location.href = './login.html';
                        resolve(null);
                    }
                });
            });
        }

        // Load available chat rooms
        async function loadChatRooms() {
            try {
                const rooms = await chatService.getChatRooms();
                displayRooms(rooms);
            } catch (error) {
                console.error('Error loading rooms:', error);
                showError('Failed to load chat rooms');
            }
        }

        // Display rooms in the UI
        function displayRooms(rooms) {
            const roomsGrid = roomsContainer.querySelector('.grid');
            roomsGrid.innerHTML = '';

            rooms.forEach(room => {
                const roomCard = createRoomCard(room);
                roomsGrid.appendChild(roomCard);
            });
        }

        // Create room card element
        function createRoomCard(room) {
            const div = document.createElement('div');
            div.className = 'chat-room bg-gray-800 rounded-xl p-4 cursor-pointer';
            div.dataset.roomId = room.id;
            
            div.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <div class="w-12 h-12 rounded-lg bg-pink-500 flex items-center justify-center">
                        <i class="fas ${room.icon || 'fa-comments'} text-xl"></i>
                    </div>
                    <span class="text-xs px-2 py-1 rounded-full ${room.isPublic ? 'bg-green-500' : 'bg-blue-500'}">
                        ${room.isPublic ? 'Public' : 'Private'}
                    </span>
                </div>
                <h3 class="font-bold text-lg mb-2">${room.name}</h3>
                <p class="text-gray-400 text-sm mb-3">${room.description || 'Join the conversation!'}</p>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-500">
                        <i class="fas fa-users mr-1"></i>
                        ${room.memberCount || 0} members
                    </span>
                    <span class="text-pink-400">
                        Join <i class="fas fa-arrow-right ml-1"></i>
                    </span>
                </div>
            `;
            
            div.addEventListener('click', () => joinRoom(room.id));
            return div;
        }

        // Join a chat room
        async function joinRoom(roomId) {
            try {
                if (!currentUser) {
                    throw new Error('User not authenticated');
                }

                // Join room
                await chatService.joinChatRoom(
                    roomId,
                    currentUser.uid,
                    currentUser.displayName || currentUser.email.split('@')[0]
                );

                // Get room info
                const roomInfo = await chatService.getRoomInfo(roomId);
                
                // Update UI
                currentRoomId = roomId;
                roomsContainer.classList.add('hidden');
                chatContainer.classList.remove('hidden');
                
                roomName.textContent = roomInfo.name;
                mobileRoomName.textContent = roomInfo.name;
                roomDescription.textContent = roomInfo.description || 'No description available';

                // Start listening to messages
                chatService.listenToMessages(roomId, handleNewMessages);
                
                // Start listening to members
                chatService.listenToRoomMembers(roomId, handleRoomMembers);

                // Clear messages container
                messagesContainer.innerHTML = '';

                // Focus on message input
                messageInput.focus();

            } catch (error) {
                console.error('Error joining room:', error);
                showError('Failed to join chat room');
            }
        }

        // Handle new messages
        function handleNewMessages(messages) {
            messagesContainer.innerHTML = '';
            
            if (messages.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'text-center text-gray-500 py-8';
                emptyState.innerHTML = `
                    <i class="fas fa-comments text-4xl mb-3"></i>
                    <p>No messages yet. Start the conversation!</p>
                `;
                messagesContainer.appendChild(emptyState);
                return;
            }

            messages.forEach(message => {
                const messageElement = createMessageElement(message);
                messagesContainer.appendChild(messageElement);
            });

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Create message element
        function createMessageElement(message) {
            const isSelf = message.userId === currentUser.uid;
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isSelf ? 'justify-end' : 'justify-start'}`;
            messageDiv.dataset.messageId = message.id;
            
            const time = message.timestamp?.toDate ? 
                formatTime(message.timestamp.toDate()) : 
                'Just now';
            
            const editedBadge = message.edited ? 
                '<span class="text-xs text-gray-400 ml-2">(edited)</span>' : '';

            messageDiv.innerHTML = `
                <div class="max-w-[80%] ${isSelf ? 'message-self' : 'message-other'} p-3">
                    ${!isSelf ? 
                        `<div class="font-bold text-sm mb-1">${message.userName}</div>` : 
                        ''
                    }
                    <div class="mb-1">${escapeHtml(message.text)}</div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs opacity-75">${time}${editedBadge}</span>
                        ${isSelf ? 
                            `<button class="message-menu-btn text-xs opacity-50 hover:opacity-100">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>` : 
                            ''
                        }
                    </div>
                </div>
            `;
            
            if (isSelf) {
                const menuBtn = messageDiv.querySelector('.message-menu-btn');
                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showMessageContextMenu(e, message.id, message.text);
                });
            }
            
            return messageDiv;
        }

        // Handle room members
        function handleRoomMembers(members) {
            membersList.innerHTML = '';
            membersCount.textContent = members.length;
            
            members.forEach(member => {
                const memberElement = document.createElement('div');
                memberElement.className = 'flex items-center space-x-3 p-2 hover:bg-gray-700 rounded-lg';
                memberElement.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-pink-500 flex items-center justify-center">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="font-medium">${member.userName}</div>
                        <div class="text-xs text-gray-400">Active now</div>
                    </div>
                `;
                membersList.appendChild(memberElement);
            });
        }

        // Send message
        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentRoomId || !currentUser) return;

            try {
                await chatService.sendMessage(
                    currentRoomId,
                    currentUser.uid,
                    currentUser.displayName || currentUser.email.split('@')[0],
                    text
                );

                // Clear input
                messageInput.value = '';
                updateCharCount();
                
            } catch (error) {
                console.error('Error sending message:', error);
                showError('Failed to send message');
            }
        }

        // Leave room
        async function leaveRoom() {
            if (!currentRoomId || !currentUser) return;

            try {
                await chatService.leaveChatRoom(currentRoomId, currentUser.uid);
                
                // Cleanup
                chatService.cleanup();
                currentRoomId = null;
                
                // Update UI
                chatContainer.classList.add('hidden');
                roomsContainer.classList.remove('hidden');
                
                // Reload rooms
                await loadChatRooms();
                
            } catch (error) {
                console.error('Error leaving room:', error);
                showError('Failed to leave chat room');
            }
        }

        // Show message context menu
        function showMessageContextMenu(event, messageId, messageText) {
            selectedMessageId = messageId;
            
            const menu = document.getElementById('messageContextMenu');
            menu.style.left = `${event.clientX}px`;
            menu.style.top = `${event.clientY}px`;
            menu.classList.remove('hidden');
            
            // Setup edit/delete buttons
            document.getElementById('editMessageBtn').onclick = () => {
                menu.classList.add('hidden');
                openEditMessageModal(messageText);
            };
            
            document.getElementById('deleteMessageBtn').onclick = () => {
                menu.classList.add('hidden');
                deleteMessage();
            };
            
            // Close menu when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', closeContextMenu);
            }, 100);
        }

        // Close context menu
        function closeContextMenu() {
            const menu = document.getElementById('messageContextMenu');
            menu.classList.add('hidden');
            document.removeEventListener('click', closeContextMenu);
        }

        // Open edit message modal
        function openEditMessageModal(text) {
            const modal = document.getElementById('editMessageModal');
            const textarea = document.getElementById('editMessageText');
            
            textarea.value = text;
            updateEditCharCount(text);
            
            modal.classList.remove('hidden');
            
            // Setup event listeners for modal
            document.getElementById('cancelEdit').onclick = () => {
                modal.classList.add('hidden');
            };
            
            document.getElementById('saveEdit').onclick = saveEditedMessage;
        }

        // Save edited message
        async function saveEditedMessage() {
            const newText = document.getElementById('editMessageText').value.trim();
            if (!newText || !selectedMessageId || !currentRoomId) return;

            try {
                await chatService.editMessage(currentRoomId, selectedMessageId, newText);
                
                const modal = document.getElementById('editMessageModal');
                modal.classList.add('hidden');
                
                showSuccess('Message updated');
                
            } catch (error) {
                console.error('Error editing message:', error);
                showError('Failed to edit message');
            }
        }

        // Delete message
        async function deleteMessage() {
            if (!selectedMessageId || !currentRoomId) return;

            if (confirm('Are you sure you want to delete this message?')) {
                try {
                    await chatService.deleteMessage(currentRoomId, selectedMessageId);
                    showSuccess('Message deleted');
                } catch (error) {
                    console.error('Error deleting message:', error);
                    showError('Failed to delete message');
                }
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Send message on button click
            sendMessageBtn.addEventListener('click', sendMessage);
            
            // Send message on Enter key (but allow Shift+Enter for new line)
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Character count
            messageInput.addEventListener('input', updateCharCount);
            
            // Leave room
            document.getElementById('leaveRoom').addEventListener('click', leaveRoom);
            
            // Back to rooms
            document.getElementById('backToRooms').addEventListener('click', leaveRoom);
            document.getElementById('mobileBackToRooms').addEventListener('click', leaveRoom);
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                if (currentRoomId) {
                    await leaveRoom();
                }
                await signOut(auth);
                window.location.href = './login.html';
            });
            
            // Close context menu on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeContextMenu();
                    const modal = document.getElementById('editMessageModal');
                    modal.classList.add('hidden');
                }
            });
            
            // Close modal on outside click
            document.getElementById('editMessageModal').addEventListener('click', (e) => {
                if (e.target.id === 'editMessageModal') {
                    e.target.classList.add('hidden');
                }
            });
        }

        // Utility functions
        function updateCharCount() {
            const length = messageInput.value.length;
            charCount.textContent = `${length}/500`;
            
            if (length > 450) {
                charCount.classList.add('text-yellow-400');
            } else {
                charCount.classList.remove('text-yellow-400');
            }
        }

        function updateEditCharCount(text) {
            const length = text.length;
            const charCountElement = document.querySelector('#editMessageModal .text-xs');
            if (charCountElement) {
                charCountElement.textContent = `${length}/500`;
            }
        }

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showError(message) {
            // Create error toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function showSuccess(message) {
            // Create success toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
    <script type="module" src="./auth-ui.js"></script>
>>>>>>> main
</body>

</html>